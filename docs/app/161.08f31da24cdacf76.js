(()=>{var v,It={161:(v,M,g)=>{"use strict";function F(e){return this instanceof F?(this.v=e,this):new F(e)}function k(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(O){r[O]&&(i[O]=function(R){return new Promise(function(V,Q){o.push([O,R,V,Q])>1||f(O,R)})})}function f(O,R){try{!function x(O){O.value instanceof F?Promise.resolve(O.value.v).then(y,A):L(o[0][2],O)}(r[O](R))}catch(V){L(o[0][3],V)}}function y(O){f("next",O)}function A(O){f("throw",O)}function L(O,R){O(R),o.shift(),o.length&&f(o[0][0],o[0][1])}}function nt(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function c(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=e[o]&&function(a){return new Promise(function(f,x){!function i(o,a,f,x){Promise.resolve(x).then(function(y){o({value:y,done:f})},a)}(f,x,(a=e[o](a)).done,a.value)})}}}const G=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function b(e){return"function"==typeof e}function N(e){return b(null==e?void 0:e.then)}const Z=function $(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function q(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class tt{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const o of n)o.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(b(r))try{r()}catch(o){t=o instanceof Z?o.errors:[o]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const o of i)try{jt(o)}catch(a){t=null!=t?t:[],a instanceof Z?t=[...t,...a.errors]:t.push(a)}}if(t)throw new Z(t)}}add(t){var n;if(t&&t!==this)if(this.closed)jt(t);else{if(t instanceof tt){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&q(n,t)}remove(t){const{_finalizers:n}=this;n&&q(n,t),t instanceof tt&&t._removeParent(this)}}function zt(e){return e instanceof tt||e&&"closed"in e&&b(e.remove)&&b(e.add)&&b(e.unsubscribe)}function jt(e){b(e)?e():e.unsubscribe()}tt.EMPTY=(()=>{const e=new tt;return e.closed=!0,e})();const rt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},dt={setTimeout(e,t,...n){const{delegate:r}=dt;return(null==r?void 0:r.setTimeout)?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=dt;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Lt(e){dt.setTimeout(()=>{const{onUnhandledError:t}=rt;if(!t)throw e;t(e)})}function Rt(){}const Zt=mt("C",void 0,void 0);function mt(e,t,n){return{kind:e,value:t,error:n}}let it=null;class vt extends tt{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,zt(t)&&t.add(this)):this.destination=se}static create(t,n,r){return new wt(t,n,r)}next(t){this.isStopped?bt(function te(e){return mt("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?bt(function qt(e){return mt("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?bt(Zt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const re=Function.prototype.bind;function xt(e,t){return re.call(e,t)}class ie{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){yt(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){yt(r)}else yt(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){yt(n)}}}class wt extends vt{constructor(t,n,r){let i;if(super(),b(t)||!t)i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0};else{let o;this&&rt.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe(),i={next:t.next&&xt(t.next,o),error:t.error&&xt(t.error,o),complete:t.complete&&xt(t.complete,o)}):i=t}this.destination=new ie(i)}}function yt(e){rt.useDeprecatedSynchronousErrorHandling?function ne(e){rt.useDeprecatedSynchronousErrorHandling&&it&&(it.errorThrown=!0,it.error=e)}(e):Lt(e)}function bt(e,t){const{onStoppedNotification:n}=rt;n&&dt.setTimeout(()=>n(e,t))}const se={closed:!0,next:Rt,error:function oe(e){throw e},complete:Rt},St="function"==typeof Symbol&&Symbol.observable||"@@observable";function ae(e){return e}let K=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,i){const o=function le(e){return e&&e instanceof vt||function ce(e){return e&&b(e.next)&&b(e.error)&&b(e.complete)}(e)&&zt(e)}(n)?n:new wt(n,r,i);return function ee(e){if(rt.useDeprecatedSynchronousErrorHandling){const t=!it;if(t&&(it={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=it;if(it=null,n)throw r}}else e()}(()=>{const{operator:a,source:f}=this;o.add(a?a.call(o,f):f?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=Gt(r))((i,o)=>{const a=new wt({next:f=>{try{n(f)}catch(x){o(x),a.unsubscribe()}},error:o,complete:i});this.subscribe(a)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[St](){return this}pipe(...n){return function Ft(e){return 0===e.length?ae:1===e.length?e[0]:function(n){return e.reduce((r,i)=>i(r),n)}}(n)(this)}toPromise(n){return new(n=Gt(n))((r,i)=>{let o;this.subscribe(a=>o=a,a=>i(a),()=>r(o))})}}return e.create=t=>new e(t),e})();function Gt(e){var t;return null!==(t=null!=e?e:rt.Promise)&&void 0!==t?t:Promise}function Ut(e){return b(e[St])}function _t(e){return Symbol.asyncIterator&&b(null==e?void 0:e[Symbol.asyncIterator])}function Bt(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ht=function ue(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Wt(e){return b(null==e?void 0:e[Ht])}function Xt(e){return k(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:i}=yield F(n.read());if(i)return yield F(void 0);yield yield F(r)}}finally{n.releaseLock()}})}function Nt(e){return b(null==e?void 0:e.getReader)}function st(e){if(e instanceof K)return e;if(null!=e){if(Ut(e))return function fe(e){return new K(t=>{const n=e[St]();if(b(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(G(e))return function he(e){return new K(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(N(e))return function de(e){return new K(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Lt)})}(e);if(_t(e))return kt(e);if(Wt(e))return function ye(e){return new K(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Nt(e))return function pe(e){return kt(Xt(e))}(e)}throw Bt(e)}function kt(e){return new K(t=>{(function ge(e,t){var n,r,i,o;return function d(e,t,n,r){return new(n||(n=Promise))(function(o,a){function f(A){try{y(r.next(A))}catch(L){a(L)}}function x(A){try{y(r.throw(A))}catch(L){a(L)}}function y(A){A.done?o(A.value):function i(o){return o instanceof n?o:new n(function(a){a(o)})}(A.value).then(f,x)}y((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=nt(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(a){i={error:a}}finally{try{r&&!r.done&&(o=n.return)&&(yield o.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function lt(e){return t=>{if(function me(e){return b(null==e?void 0:e.lift)}(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ut(e,t,n,r,i){return new ve(e,t,n,r,i)}class ve extends vt{constructor(t,n,r,i,o,a){super(t),this.onFinalize=o,this.shouldUnsubscribe=a,this._next=n?function(f){try{n(f)}catch(x){t.error(x)}}:super._next,this._error=i?function(f){try{i(f)}catch(x){t.error(x)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(f){t.error(f)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function pt(e,t){return lt((n,r)=>{let i=0;n.subscribe(ut(r,o=>{r.next(e.call(t,o,i++))}))})}function et(e,t,n,r=0,i=!1){const o=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(o),!i)return o}function Jt(e,t,n=1/0){return b(t)?Jt((r,i)=>pt((o,a)=>t(r,o,i,a))(st(e(r,i))),n):("number"==typeof t&&(n=t),lt((r,i)=>function xe(e,t,n,r,i,o,a,f){const x=[];let y=0,A=0,L=!1;const O=()=>{L&&!x.length&&!y&&t.complete()},R=Q=>y<r?V(Q):x.push(Q),V=Q=>{o&&t.next(Q),y++;let at=!1;st(n(Q,A++)).subscribe(ut(t,Y=>{null==i||i(Y),o?R(Y):t.next(Y)},()=>{at=!0},void 0,()=>{if(at)try{for(y--;x.length&&y<r;){const Y=x.shift();a?et(t,a,()=>V(Y)):V(Y)}O()}catch(Y){t.error(Y)}}))};return e.subscribe(ut(t,R,()=>{L=!0,O()})),()=>{null==f||f()}}(r,i,e,n)))}const{isArray:we}=Array;const Pe=["addListener","removeListener"],Ee=["addEventListener","removeEventListener"],Ae=["on","off"];function Pt(e,t,n,r){if(b(n)&&(r=n,n=void 0),r)return Pt(e,t,n).pipe(function Se(e){return pt(t=>function be(e,t){return we(t)?e(...t):e(t)}(e,t))}(r));const[i,o]=function Te(e){return b(e.addEventListener)&&b(e.removeEventListener)}(e)?Ee.map(a=>f=>e[a](t,f,n)):function Oe(e){return b(e.addListener)&&b(e.removeListener)}(e)?Pe.map(Kt(e,t)):function Me(e){return b(e.on)&&b(e.off)}(e)?Ae.map(Kt(e,t)):[];if(!i&&G(e))return Jt(a=>Pt(a,t,n))(st(e));if(!i)throw new TypeError("Invalid event target");return new K(a=>{const f=(...x)=>a.next(1<x.length?x:x[0]);return i(f),()=>o(f)})}function Kt(e,t){return n=>r=>e[n](t,r)}const Vt=new K(e=>e.complete());function Yt(e,t=0){return lt((n,r)=>{n.subscribe(ut(r,i=>et(r,e,()=>r.next(i),t),()=>et(r,e,()=>r.complete(),t),i=>et(r,e,()=>r.error(i),t)))})}function $t(e,t=0){return lt((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function Qt(e,t){if(!e)throw new Error("Iterable cannot be null");return new K(n=>{et(n,t,()=>{const r=e[Symbol.asyncIterator]();et(n,t,()=>{r.next().then(i=>{i.done?n.complete():n.next(i.value)})},0,!0)})})}function Be(...e){return function _e(e,t){return t?function Ue(e,t){if(null!=e){if(Ut(e))return function je(e,t){return st(e).pipe($t(t),Yt(t))}(e,t);if(G(e))return function Re(e,t){return new K(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(N(e))return function Le(e,t){return st(e).pipe($t(t),Yt(t))}(e,t);if(_t(e))return Qt(e,t);if(Wt(e))return function Fe(e,t){return new K(n=>{let r;return et(n,t,()=>{r=e[Ht](),et(n,t,()=>{let i,o;try{({value:i,done:o}=r.next())}catch(a){return void n.error(a)}o?n.complete():n.next(i)},0,!0)}),()=>b(null==r?void 0:r.return)&&r.return()})}(e,t);if(Nt(e))return function Ge(e,t){return Qt(Xt(e),t)}(e,t)}throw Bt(e)}(e,t):st(e)}(e,function ze(e){return function De(e){return e&&b(e.schedule)}(function Et(e){return e[e.length-1]}(e))?e.pop():void 0}(e))}var He=g(340);class ft{constructor(t={}){this.minSegments=50,this.maxSegments=1e5,this.xComputeFactor=.5,this.yComputeFactor=.5,this.angleComputeFactor=9,this.maxTrys=20,this.maxCurve=45,this.gateDistance=10,this.curveComputeCount=4,this.maxIterations=1e6,this.minGateHalfSize=5,this.maxGateHalfSize=15,this.maxCollisions=0,this.distanceMatch=19,this.angleMatch=.3;for(const n of this.getPropertyNames())this.setProperty(n,t[n])}getType(t){return typeof t}setProperty(t,n){this.getType(this.getProperty(t))===this.getType(n)&&(this[t]=n)}getProperty(t){return this[t]}getPropertyNames(){return Object.getOwnPropertyNames(this)}validate(){this.minSegments=Math.min(this.minSegments,this.maxSegments)}copy(){return ft.unserialize(this.serialize())}serialize(){return JSON.stringify(Object.assign({},this))}static unserialize(t){return new ft(JSON.parse(t))}}class At{constructor(t,n,r,i=null,o=null,a){this.debugCanvasContext=null,this.trackCanvasContext=null,this.width=t,this.height=n,this.collisions=r,null!==o&&(this.trackCanvasContext=o.getContext("2d")),null!==i&&(this.debugCanvasContext=i.getContext("2d")),this.gates=a}drawPoint(t,n,r="#fff"){null!==t&&(t.fillStyle=r,t.fillRect(n[0]-1,n[1]-1,2,2))}drawGate(t,n,r="#f00",i="#0f0"){null!==t&&(this.drawPoint(t,n[0],r),this.drawPoint(t,n[1],i))}drawLine(t,n,r="#f00"){null!==t&&(t.strokeStyle=r,t.beginPath(),t.moveTo(n[0][0],n[0][1]),t.lineTo(n[1][0],n[1][1]),t.stroke())}serialize(){return JSON.stringify({width:this.width,height:this.height,collisions:this.collisions,gates:this.gates})}static unserialize(t){const n=JSON.parse(t);return new At(n.width,n.height,n.collisions,null,null,n.gates)}getBarrierLines(t=0,n=-1){n<0&&(n=this.gates.length);const r=[];for(let i=n-1;i>t+1;i--)for(let o of[0,1])r.push([this.gates[i][o],this.gates[i-1][o]]);return r}firstGate(){return this.gates[0]}lastGate(){return this.gates[this.gates.length-1]}deleteLastGates(t){this.gates.splice(this.gates.length-t,t)}drawTrack(t=0,n=-1){if(null!==this.trackCanvasContext){this.trackCanvasContext.clearRect(0,0,this.width,this.height),n<0&&(n=this.gates.length);for(let r of this.getBarrierLines(t,n))this.drawLine(this.trackCanvasContext,r,"#fff");for(let r=t;r<n;r++)this.drawGate(this.trackCanvasContext,this.gates[r])}}}class j{constructor(t,n,r,i="random",o="",a=new ft){this.track=t,this.startGate=n,this.endGate=r,this.mode=i,this.settings=a,""===o&&(o=(""+Math.random()).substring(2)),this.seed=o,this.random=He(o)}pointEquals(t,n){return t[0]==n[0]&&t[1]==n[1]}lineEqualsStrict(t,n){return this.pointEquals(t[0],n[0])&&this.pointEquals(t[1],n[1])}gateCenterPos(t){return[t[0][0]+.5*(t[1][0]-t[0][0]),t[0][1]+.5*(t[1][1]-t[0][1])]}degreesToRadians(t){return t*(Math.PI/180)}static normalizeAngle(t){return t-this.TWO_PI*Math.floor((t+Math.PI)/this.TWO_PI)}static normalizeAngle10(t){return(t+Math.PI)/this.TWO_PI}static vectorAngle(t){return Math.atan2(t[1],t[0])}angleToVector(t){return[Math.cos(t),Math.sin(t)]}angleToVectorMultiplied(t,n){return[Math.cos(t)*n,Math.sin(t)*n]}static lineAngle(t){return this.vectorAngle([t[1][0]-t[0][0],t[1][1]-t[0][1]])}static gateAngle(t){return this.normalizeAngle(this.lineAngle(t)-.5*Math.PI)}static lineLengthUnnormed(t){const n=t[0][0]-t[1][0],r=t[0][1]-t[1][1];return n*n+r*r}static lineLength(t){return Math.sqrt(this.lineLengthUnnormed(t))}static pointToGate(t,n,r,i=!1){return[this.pointTravel(t,n-.5*Math.PI,r,i),this.pointTravel(t,n+.5*Math.PI,r,i)]}static pointTravel(t,n,r,i=!1){const o=[t[0]+Math.cos(n)*r,t[1]+Math.sin(n)*r];return i&&(o[0]=Math.round(o[0]),o[1]=Math.round(o[1])),o}boundsLines(){return[[[0,0],[this.track.width,0]],[[0,0],[0,this.track.height]],[[this.track.width,this.track.height],[this.track.width,0]],[[this.track.width,this.track.height],[0,this.track.height]]]}pointOutBounds(t){return t[0]<0||t[1]<0||t[0]>this.track.width||t[1]>this.track.height}static centerOfLine(t){return[.5*(t[0][0]+t[1][0]),.5*(t[0][1]+t[1][1])]}lineOutBounds(t){return this.pointOutBounds(t[0])||this.pointOutBounds(t[1])}lineIntersectionPoint(t,n){let L,O,R,r=t[0][0],i=t[0][1],o=t[1][0],a=t[1][1],f=n[0][0],x=n[0][1],y=n[1][0],A=n[1][1];return L=(o-r)*(A-x)-(y-f)*(a-i),0!==L&&(R=((A-x)*(y-r)+(f-y)*(A-i))/L,O=((i-a)*(y-r)+(o-r)*(A-i))/L,0<R&&R<1&&0<O&&O<1)?[r+R*(o-r),i+R*(a-i)]:null}gateHasCollision(t,n,r){const i=[[t[0],n[0]],[n[0],n[1]],[n[1],t[1]]];if(this.hasPolyPixelCollision(i.concat([[t[0],t[1]]])))return!0;for(let o of i){const a=this.track.gates.concat(r);for(let f=a.length-1;f>1;f--)for(let x of[0,1])if(null!==this.lineIntersectionPoint([o[0],o[1]],[a[f][x],a[f-1][x]]))return!0}return!1}getLinesBounds(t){var n=1/0,r=1/0,i=-1/0,o=-1/0;for(const a of t)n=Math.min(n,a[0][1],a[1][1]),r=Math.min(r,a[0][0],a[1][0]),i=Math.max(i,a[0][0],a[1][0]),o=Math.max(o,a[0][1],a[1][1]);return[Math.floor(n),Math.floor(r),Math.floor(i),Math.floor(o)]}hasRectangleCollision(t,n){return t[1]<n[2]&&t[2]>n[1]&&t[0]<n[3]&&t[3]>n[0]}hasPolyPixelCollision(t){const n=this.getLinesBounds(t);for(let r=n[0];r<n[3];r++)for(let i=n[1];i<n[2];i++)if(this.track.collisions[r][i])return!0;return!1}hasPolyPolyCollision(t,n){const r=this.getLinesBounds(t),i=this.getLinesBounds(n);return this.hasRectangleCollision(r,i)}serialize(){return JSON.stringify({track:this.track.serialize(),start:this.startGate,end:this.endGate,mode:this.mode,seed:this.seed,settings:this.settings.serialize()})}static unserialize(t){const n=JSON.parse(t);return new j(At.unserialize(n.track),n.start,n.end,n.mode,n.seed,ft.unserialize(n.settings))}calcMaxGateHalfSize(t,n){let o,r=j.pointToGate(t,n,this.track.width*this.track.height),i=+this.settings.maxGateHalfSize;const a=this.track.gates.concat(this.boundsLines());for(let f=a.length-1;f>1;f--)for(let x of[0,1])if(o=this.lineIntersectionPoint([r[0],r[1]],[a[f][x],a[f-1][x]]),null!==o){const y=j.lineLength([o,t]);(y<0||y<i)&&(i=y)}return i}predictDirections(t,n,r){const i=j.lineAngle([t,n]),o=[j.normalizeAngle(r)];for(let f=+this.settings.curveComputeCount-1;f>0;f--){const x=f*this.degreesToRadians(+this.settings.maxCurve)/+this.settings.curveComputeCount;o.push(j.normalizeAngle(r+x)),o.push(j.normalizeAngle(r-x))}o.sort((f,x)=>Math.abs(j.normalizeAngle(i-x))-Math.abs(j.normalizeAngle(i-f)));const a=[];for(const f of o)a.push(this.angleToVectorMultiplied(f,+this.settings.gateDistance));return a}randomShuffle(t){return t.sort(()=>.5-this.random())}pointAngleMatches(t,n,r,i){return!(j.lineLengthUnnormed([t,r])>+this.settings.distanceMatch||Math.abs(j.normalizeAngle(n-i))>+this.settings.angleMatch)}posAngleToGrid(t,n){return[Math.floor(t[1]*+this.settings.yComputeFactor),Math.floor(t[0]*+this.settings.xComputeFactor),Math.floor(j.normalizeAngle10(n)*+this.settings.angleComputeFactor)]}isValidGridPos(t,n){return t[0]>=0&&t[0]<n[0]&&t[1]>=0&&t[1]<n[1]&&t[2]>=0&&t[2]<n[2]}findTrackDFS(t=0,n=0){this.settings.validate();const r=[],i=this.gateCenterPos(this.endGate),o=j.gateAngle(this.endGate),a=this.posAngleToGrid([this.track.width,this.track.height],Math.PI);console.log(a);const f=new Array(a[0]);for(let x=0;x<a[0];x++){f[x]=new Array(a[1]);for(let y=0;y<a[1];y++){f[x][y]=new Array(a[2]);for(let A=0;A<a[2];A++)f[x][y][A]=!1}}for(r.push([this.startGate,[],0]);;){let x=r.pop();if(void 0===x)return n>=+this.settings.maxTrys-1?[[],!1,t]:(this.settings.angleComputeFactor+=1,this.findTrackDFS(t,n+1));const y=x[0],A=x[1];let L=x[2];const O=this.gateCenterPos(y),R=j.gateAngle(y),V=this.posAngleToGrid(O,R);f[V[0]][V[1]][V[2]]=!0,this.track.drawPoint(this.track.debugCanvasContext,O,"#fff");const Q=this.pointAngleMatches(O,R,i,o),at=A.length,Y=Q&&at>=+this.settings.minSegments;if(Y||at>=+this.settings.maxSegments)return Y&&A.push(this.endGate),console.log(at+" segments"),console.log(L+" collisions"),[A,Q,t];let ht=this.predictDirections(O,i,R);switch(this.mode){case"worst":ht=ht.reverse();break;case"random":ht=this.randomShuffle(ht)}for(let Ot of ht){const Mt=[Math.floor(O[0]+Ot[0]),Math.floor(O[1]+Ot[1])],Tt=j.vectorAngle(Ot);let ct=Math.min(+this.settings.maxGateHalfSize,this.calcMaxGateHalfSize(Mt,Tt));ct>+this.settings.minGateHalfSize&&(ct=+this.settings.minGateHalfSize+this.random()*(ct-+this.settings.minGateHalfSize)),ct=Math.max(+this.settings.minGateHalfSize,ct);const Ct=j.pointToGate(Mt,Tt,ct),gt=this.posAngleToGrid(Mt,Tt);this.isValidGridPos(gt,a)&&!f[gt[0]][gt[1]][gt[2]]&&!this.lineOutBounds(Ct)&&(this.gateHasCollision(y,Ct,A)&&(L+=1),L<=+this.settings.maxCollisions&&r.push([Ct,A.concat([y]),L]))}if(++t>+this.settings.maxIterations)return[[],!1,t]}}findTrackDFSWorker(t=!0){if(t&&"undefined"!=typeof Worker){const n=new Worker(g.tu(new URL(g.p+g.u(161),g.b))),r=Pt(n,"message").pipe(function Ie(e){return e<=0?()=>Vt:lt((t,n)=>{let r=0;t.subscribe(ut(n,i=>{++r<=e&&(n.next(i),e<=r&&n.complete())}))})}(1),pt(i=>(console.log(i.data),i.data)));return n.postMessage({type:"start",trackGenerator:this.serialize()}),r}return Be(this.findTrackDFS())}generate(t=!0){const n=(new Date).getTime();return this.findTrackDFSWorker(t).pipe(pt(r=>{const i=(new Date).getTime()-n;if(0==r[0].length)return console.log("path was not found!"),[i,r[2]];const o=r[0];r[1]&&console.log("path is finished");const a=o.length;for(let f=0;f<a;f++)f>0&&this.track.gates.push(o[f]);return[i,r[2]]}))}}j.TWO_PI=2*Math.PI,addEventListener("message",({data:e})=>{const t=j.unserialize(e.trackGenerator);postMessage(t.findTrackDFS())})},340:(v,M,g)=>{var P=g(471),_=g(992),w=g(657),B=g(583),C=g(929),I=g(83),S=g(818);S.alea=P,S.xor128=_,S.xorwow=w,S.xorshift7=B,S.xor4096=C,S.tychei=I,v.exports=S},471:function(v,M,g){var P;!function(_,w,B){function C(s){var u=this,h=function d(){var s=4022871197;return function(h){h=String(h);for(var c=0;c<h.length;c++){var l=.02519603282416938*(s+=h.charCodeAt(c));l-=s=l>>>0,s=(l*=s)>>>0,s+=4294967296*(l-=s)}return 2.3283064365386963e-10*(s>>>0)}}();u.next=function(){var c=2091639*u.s0+2.3283064365386963e-10*u.c;return u.s0=u.s1,u.s1=u.s2,u.s2=c-(u.c=0|c)},u.c=1,u.s0=h(" "),u.s1=h(" "),u.s2=h(" "),u.s0-=h(s),u.s0<0&&(u.s0+=1),u.s1-=h(s),u.s1<0&&(u.s1+=1),u.s2-=h(s),u.s2<0&&(u.s2+=1),h=null}function I(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function S(s,u){var h=new C(s),c=u&&u.state,l=h.next;return l.int32=function(){return 4294967296*h.next()|0},l.double=function(){return l()+11102230246251565e-32*(2097152*l()|0)},l.quick=l,c&&("object"==typeof c&&I(c,h),l.state=function(){return I(h,{})}),l}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(P=function(){return S}.call(M,g,M,w))&&(w.exports=P):this.alea=S}(0,v=g.nmd(v))},83:function(v,M,g){var P;!function(_,w,B){function C(d){var s=this,u="";s.next=function(){var c=s.b,l=s.c,p=s.d,m=s.a;return c=c<<25^c>>>7^l,l=l-p|0,p=p<<24^p>>>8^m,m=m-c|0,s.b=c=c<<20^c>>>12^l,s.c=l=l-p|0,s.d=p<<16^l>>>16^m,s.a=m-c|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,d===Math.floor(d)?(s.a=d/4294967296|0,s.b=0|d):u+=d;for(var h=0;h<u.length+20;h++)s.b^=0|u.charCodeAt(h),s.next()}function I(d,s){return s.a=d.a,s.b=d.b,s.c=d.c,s.d=d.d,s}function S(d,s){var u=new C(d),h=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&("object"==typeof h&&I(h,u),c.state=function(){return I(u,{})}),c}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(P=function(){return S}.call(M,g,M,w))&&(w.exports=P):this.tychei=S}(0,v=g.nmd(v))},992:function(v,M,g){var P;!function(_,w,B){function C(d){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var c=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^c^c>>>8},d===(0|d)?s.x=d:u+=d;for(var h=0;h<u.length+64;h++)s.x^=0|u.charCodeAt(h),s.next()}function I(d,s){return s.x=d.x,s.y=d.y,s.z=d.z,s.w=d.w,s}function S(d,s){var u=new C(d),h=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&("object"==typeof h&&I(h,u),c.state=function(){return I(u,{})}),c}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(P=function(){return S}.call(M,g,M,w))&&(w.exports=P):this.xor128=S}(0,v=g.nmd(v))},929:function(v,M,g){var P;!function(_,w,B){function C(d){var s=this;s.next=function(){var p,m,h=s.w,c=s.X,l=s.i;return s.w=h=h+1640531527|0,m=c[l+34&127],p=c[l=l+1&127],m^=m<<13,p^=p<<17,m=c[l]=(m^=m>>>15)^(p^=p>>>12),s.i=l,m+(h^h>>>16)|0},function u(h,c){var l,p,m,H,F,k=[],ot=128;for(c===(0|c)?(p=c,c=null):(c+="\0",p=0,ot=Math.max(ot,c.length)),m=0,H=-32;H<ot;++H)c&&(p^=c.charCodeAt((H+32)%c.length)),0===H&&(F=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,H>=0&&(m=0==(l=k[127&H]^=p+(F=F+1640531527|0))?m+1:0);for(m>=128&&(k[127&(c&&c.length||0)]=-1),m=127,H=512;H>0;--H)p=k[m+34&127],l=k[m=m+1&127],p^=p<<13,l^=l<<17,k[m]=(p^=p>>>15)^(l^=l>>>12);h.w=F,h.X=k,h.i=m}(s,d)}function I(d,s){return s.i=d.i,s.w=d.w,s.X=d.X.slice(),s}function S(d,s){null==d&&(d=+new Date);var u=new C(d),h=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&(h.X&&I(h,u),c.state=function(){return I(u,{})}),c}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(P=function(){return S}.call(M,g,M,w))&&(w.exports=P):this.xor4096=S}(0,v=g.nmd(v))},583:function(v,M,g){var P;!function(_,w,B){function C(d){var s=this;s.next=function(){var l,p,h=s.x,c=s.i;return l=h[c],p=(l^=l>>>7)^l<<24,p^=(l=h[c+1&7])^l>>>10,p^=(l=h[c+3&7])^l>>>3,p^=(l=h[c+4&7])^l<<7,l=h[c+7&7],h[c]=p^=(l^=l<<13)^l<<9,s.i=c+1&7,p},function u(h,c){var l,m=[];if(c===(0|c))m[0]=c;else for(c=""+c,l=0;l<c.length;++l)m[7&l]=m[7&l]<<15^c.charCodeAt(l)+m[l+1&7]<<13;for(;m.length<8;)m.push(0);for(l=0;l<8&&0===m[l];++l);for(8==l&&(m[7]=-1),h.x=m,h.i=0,l=256;l>0;--l)h.next()}(s,d)}function I(d,s){return s.x=d.x.slice(),s.i=d.i,s}function S(d,s){null==d&&(d=+new Date);var u=new C(d),h=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&(h.x&&I(h,u),c.state=function(){return I(u,{})}),c}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(P=function(){return S}.call(M,g,M,w))&&(w.exports=P):this.xorshift7=S}(0,v=g.nmd(v))},657:function(v,M,g){var P;!function(_,w,B){function C(d){var s=this,u="";s.next=function(){var c=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^c^c<<1)|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,d===(0|d)?s.x=d:u+=d;for(var h=0;h<u.length+64;h++)s.x^=0|u.charCodeAt(h),h==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function I(d,s){return s.x=d.x,s.y=d.y,s.z=d.z,s.w=d.w,s.v=d.v,s.d=d.d,s}function S(d,s){var u=new C(d),h=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&("object"==typeof h&&I(h,u),c.state=function(){return I(u,{})}),c}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(P=function(){return S}.call(M,g,M,w))&&(w.exports=P):this.xorwow=S}(0,v=g.nmd(v))},818:function(v,M,g){var P;!function(_,w,B){var l,C=256,s=B.pow(C,6),u=B.pow(2,52),h=2*u,c=255;function p(E,T,U){var z=[],D=k(F((T=1==T?{entropy:!0}:T||{}).entropy?[E,nt(w)]:null==E?function ot(){try{var E;return l&&(E=l.randomBytes)?E=E(C):(E=new Uint8Array(C),(_.crypto||_.msCrypto).getRandomValues(E)),nt(E)}catch(z){var T=_.navigator,U=T&&T.plugins;return[+new Date,_,U,_.screen,nt(w)]}}():E,3),z),X=new m(z),J=function(){for(var G=X.g(6),b=s,N=0;G<u;)G=(G+N)*C,b*=C,N=X.g(1);for(;G>=h;)G/=2,b/=2,N>>>=1;return(G+N)/b};return J.int32=function(){return 0|X.g(4)},J.quick=function(){return X.g(4)/4294967296},J.double=J,k(nt(X.S),w),(T.pass||U||function(G,b,N,$){return $&&($.S&&H($,X),G.state=function(){return H(X,{})}),N?(B.random=G,b):G})(J,D,"global"in T?T.global:this==B,T.state)}function m(E){var T,U=E.length,z=this,D=0,X=z.i=z.j=0,J=z.S=[];for(U||(E=[U++]);D<C;)J[D]=D++;for(D=0;D<C;D++)J[D]=J[X=c&X+E[D%U]+(T=J[D])],J[X]=T;(z.g=function(G){for(var b,N=0,$=z.i,Z=z.j,q=z.S;G--;)b=q[$=c&$+1],N=N*C+q[c&(q[$]=q[Z=c&Z+b])+(q[Z]=b)];return z.i=$,z.j=Z,N})(C)}function H(E,T){return T.i=E.i,T.j=E.j,T.S=E.S.slice(),T}function F(E,T){var D,U=[],z=typeof E;if(T&&"object"==z)for(D in E)try{U.push(F(E[D],T-1))}catch(X){}return U.length?U:"string"==z?E:E+"\0"}function k(E,T){for(var z,U=E+"",D=0;D<U.length;)T[c&D]=c&(z^=19*T[c&D])+U.charCodeAt(D++);return nt(T)}function nt(E){return String.fromCharCode.apply(0,E)}if(k(B.random(),w),v.exports){v.exports=p;try{l=g(42)}catch(E){}}else void 0!==(P=function(){return p}.call(M,g,M,v))&&(v.exports=P)}("undefined"!=typeof self?self:this,[],Math)},42:()=>{}},Dt={};function W(v){var M=Dt[v];if(void 0!==M)return M.exports;var g=Dt[v]={id:v,loaded:!1,exports:{}};return It[v].call(g.exports,g,g.exports,W),g.loaded=!0,g.exports}W.m=It,W.amdD=function(){throw new Error("define cannot be used indirect")},W.amdO={},W.u=v=>v+".08f31da24cdacf76.js",W.o=(v,M)=>Object.prototype.hasOwnProperty.call(v,M),W.nmd=v=>(v.paths=[],v.children||(v.children=[]),v),W.tt=()=>(void 0===v&&(v={createScriptURL:M=>M},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(v=trustedTypes.createPolicy("angular#bundler",v))),v),W.tu=v=>W.tt().createScriptURL(v),W.p="",W.b=self.location+"",W(161)})();