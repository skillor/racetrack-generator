(()=>{var v,Mt={161:(v,A,g)=>{"use strict";function _(e){return this instanceof _?(this.v=e,this):new _(e)}function N(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i;function c(P){r[P]&&(i[P]=function(G){return new Promise(function(V,$){o.push([P,G,V,$])>1||h(P,G)})})}function h(P,G){try{!function x(P){P.value instanceof _?Promise.resolve(P.value.v).then(p,O):j(o[0][2],P)}(r[P](G))}catch(V){j(o[0][3],V)}}function p(P){h("next",P)}function O(P){h("throw",P)}function j(P,G){P(G),o.shift(),o.length&&h(o[0][0],o[0][1])}}function et(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function a(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=e[o]&&function(c){return new Promise(function(h,x){!function i(o,c,h,x){Promise.resolve(x).then(function(p){o({value:p,done:h})},c)}(h,x,(c=e[o](c)).done,c.value)})}}}const L=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function b(e){return"function"==typeof e}function X(e){return b(null==e?void 0:e.then)}const Q=function Y(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function Z(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class q{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const o of n)o.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(b(r))try{r()}catch(o){t=o instanceof Q?o.errors:[o]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const o of i)try{zt(o)}catch(c){t=null!=t?t:[],c instanceof Q?t=[...t,...c.errors]:t.push(c)}}if(t)throw new Q(t)}}add(t){var n;if(t&&t!==this)if(this.closed)zt(t);else{if(t instanceof q){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&Z(n,t)}remove(t){const{_finalizers:n}=this;n&&Z(n,t),t instanceof q&&t._removeParent(this)}}function Dt(e){return e instanceof q||e&&"closed"in e&&b(e.remove)&&b(e.add)&&b(e.unsubscribe)}function zt(e){b(e)?e():e.unsubscribe()}q.EMPTY=(()=>{const e=new q;return e.closed=!0,e})();const nt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ft={setTimeout(e,t,...n){const{delegate:r}=ft;return(null==r?void 0:r.setTimeout)?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=ft;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function jt(e){ft.setTimeout(()=>{const{onUnhandledError:t}=nt;if(!t)throw e;t(e)})}function Gt(){}const Qt=yt("C",void 0,void 0);function yt(e,t,n){return{kind:e,value:t,error:n}}let rt=null;class gt extends q{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Dt(t)&&t.add(this)):this.destination=oe}static create(t,n,r){return new vt(t,n,r)}next(t){this.isStopped?xt(function qt(e){return yt("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?xt(function Zt(e){return yt("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?xt(Qt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ne=Function.prototype.bind;function mt(e,t){return ne.call(e,t)}class re{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){ht(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){ht(r)}else ht(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){ht(n)}}}class vt extends gt{constructor(t,n,r){let i;if(super(),b(t)||!t)i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0};else{let o;this&&nt.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe(),i={next:t.next&&mt(t.next,o),error:t.error&&mt(t.error,o),complete:t.complete&&mt(t.complete,o)}):i=t}this.destination=new re(i)}}function ht(e){nt.useDeprecatedSynchronousErrorHandling?function ee(e){nt.useDeprecatedSynchronousErrorHandling&&rt&&(rt.errorThrown=!0,rt.error=e)}(e):jt(e)}function xt(e,t){const{onStoppedNotification:n}=nt;n&&ft.setTimeout(()=>n(e,t))}const oe={closed:!0,next:Gt,error:function ie(e){throw e},complete:Gt},wt="function"==typeof Symbol&&Symbol.observable||"@@observable";function se(e){return e}let K=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,i){const o=function ce(e){return e&&e instanceof gt||function ae(e){return e&&b(e.next)&&b(e.error)&&b(e.complete)}(e)&&Dt(e)}(n)?n:new vt(n,r,i);return function te(e){if(nt.useDeprecatedSynchronousErrorHandling){const t=!rt;if(t&&(rt={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=rt;if(rt=null,n)throw r}}else e()}(()=>{const{operator:c,source:h}=this;o.add(c?c.call(o,h):h?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=Lt(r))((i,o)=>{const c=new vt({next:h=>{try{n(h)}catch(x){o(x),c.unsubscribe()}},error:o,complete:i});this.subscribe(c)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[wt](){return this}pipe(...n){return function _t(e){return 0===e.length?se:1===e.length?e[0]:function(n){return e.reduce((r,i)=>i(r),n)}}(n)(this)}toPromise(n){return new(n=Lt(n))((r,i)=>{let o;this.subscribe(c=>o=c,c=>i(c),()=>r(o))})}}return e.create=t=>new e(t),e})();function Lt(e){var t;return null!==(t=null!=e?e:nt.Promise)&&void 0!==t?t:Promise}function Rt(e){return b(e[wt])}function Ft(e){return Symbol.asyncIterator&&b(null==e?void 0:e[Symbol.asyncIterator])}function Ut(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const kt=function ue(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ht(e){return b(null==e?void 0:e[kt])}function Wt(e){return N(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:i}=yield _(n.read());if(i)return yield _(void 0);yield yield _(r)}}finally{n.releaseLock()}})}function Bt(e){return b(null==e?void 0:e.getReader)}function ot(e){if(e instanceof K)return e;if(null!=e){if(Rt(e))return function le(e){return new K(t=>{const n=e[wt]();if(b(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(L(e))return function fe(e){return new K(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(X(e))return function he(e){return new K(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,jt)})}(e);if(Ft(e))return Xt(e);if(Ht(e))return function de(e){return new K(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Bt(e))return function pe(e){return Xt(Wt(e))}(e)}throw Ut(e)}function Xt(e){return new K(t=>{(function ye(e,t){var n,r,i,o;return function d(e,t,n,r){return new(n||(n=Promise))(function(o,c){function h(O){try{p(r.next(O))}catch(j){c(j)}}function x(O){try{p(r.throw(O))}catch(j){c(j)}}function p(O){O.done?o(O.value):function i(o){return o instanceof n?o:new n(function(c){c(o)})}(O.value).then(h,x)}p((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=et(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(c){i={error:c}}finally{try{r&&!r.done&&(o=n.return)&&(yield o.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function ct(e){return t=>{if(function ge(e){return b(null==e?void 0:e.lift)}(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ut(e,t,n,r,i){return new me(e,t,n,r,i)}class me extends gt{constructor(t,n,r,i,o,c){super(t),this.onFinalize=o,this.shouldUnsubscribe=c,this._next=n?function(h){try{n(h)}catch(x){t.error(x)}}:super._next,this._error=i?function(h){try{i(h)}catch(x){t.error(x)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(h){t.error(h)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function dt(e,t){return ct((n,r)=>{let i=0;n.subscribe(ut(r,o=>{r.next(e.call(t,o,i++))}))})}function tt(e,t,n,r=0,i=!1){const o=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(o),!i)return o}function Nt(e,t,n=1/0){return b(t)?Nt((r,i)=>dt((o,c)=>t(r,o,i,c))(ot(e(r,i))),n):("number"==typeof t&&(n=t),ct((r,i)=>function ve(e,t,n,r,i,o,c,h){const x=[];let p=0,O=0,j=!1;const P=()=>{j&&!x.length&&!p&&t.complete()},G=$=>p<r?V($):x.push($),V=$=>{o&&t.next($),p++;let st=!1;ot(n($,O++)).subscribe(ut(t,H=>{null==i||i(H),o?G(H):t.next(H)},()=>{st=!0},void 0,()=>{if(st)try{for(p--;x.length&&p<r;){const H=x.shift();c?tt(t,c,()=>V(H)):V(H)}P()}catch(H){t.error(H)}}))};return e.subscribe(ut(t,G,()=>{j=!0,P()})),()=>{null==h||h()}}(r,i,e,n)))}const{isArray:xe}=Array;const Se=["addListener","removeListener"],Ee=["addEventListener","removeEventListener"],Te=["on","off"];function bt(e,t,n,r){if(b(n)&&(r=n,n=void 0),r)return bt(e,t,n).pipe(function be(e){return dt(t=>function we(e,t){return xe(t)?e(...t):e(t)}(e,t))}(r));const[i,o]=function Oe(e){return b(e.addEventListener)&&b(e.removeEventListener)}(e)?Ee.map(c=>h=>e[c](t,h,n)):function Pe(e){return b(e.addListener)&&b(e.removeListener)}(e)?Se.map(Jt(e,t)):function Ae(e){return b(e.on)&&b(e.off)}(e)?Te.map(Jt(e,t)):[];if(!i&&L(e))return Nt(c=>bt(c,t,n))(ot(e));if(!i)throw new TypeError("Invalid event target");return new K(c=>{const h=(...x)=>c.next(1<x.length?x:x[0]);return i(h),()=>o(h)})}function Jt(e,t){return n=>r=>e[n](t,r)}const Kt=new K(e=>e.complete());function Vt(e,t=0){return ct((n,r)=>{n.subscribe(ut(r,i=>tt(r,e,()=>r.next(i),t),()=>tt(r,e,()=>r.complete(),t),i=>tt(r,e,()=>r.error(i),t)))})}function Yt(e,t=0){return ct((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function $t(e,t){if(!e)throw new Error("Iterable cannot be null");return new K(n=>{tt(n,t,()=>{const r=e[Symbol.asyncIterator]();tt(n,t,()=>{r.next().then(i=>{i.done?n.complete():n.next(i.value)})},0,!0)})})}function Ue(...e){return function Fe(e,t){return t?function Re(e,t){if(null!=e){if(Rt(e))return function ze(e,t){return ot(e).pipe(Yt(t),Vt(t))}(e,t);if(L(e))return function Ge(e,t){return new K(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(X(e))return function je(e,t){return ot(e).pipe(Yt(t),Vt(t))}(e,t);if(Ft(e))return $t(e,t);if(Ht(e))return function _e(e,t){return new K(n=>{let r;return tt(n,t,()=>{r=e[kt](),tt(n,t,()=>{let i,o;try{({value:i,done:o}=r.next())}catch(c){return void n.error(c)}o?n.complete():n.next(i)},0,!0)}),()=>b(null==r?void 0:r.return)&&r.return()})}(e,t);if(Bt(e))return function Le(e,t){return $t(Wt(e),t)}(e,t)}throw Ut(e)}(e,t):ot(e)}(e,function De(e){return function Ie(e){return e&&b(e.schedule)}(function St(e){return e[e.length-1]}(e))?e.pop():void 0}(e))}var ke=g(340);class lt{constructor(t={}){this.minSegments=50,this.maxSegments=1e5,this.xComputeFactor=.5,this.yComputeFactor=.5,this.angleComputeFactor=9,this.maxTrys=20,this.maxCurve=45,this.gateDistance=10,this.curveComputeCount=4,this.maxIterations=1e6,this.minGateHalfSize=5,this.maxGateHalfSize=15,this.maxCollisions=0;for(const n of this.getPropertyNames())this.setProperty(n,t[n])}getType(t){return typeof t}setProperty(t,n){this.getType(this.getProperty(t))===this.getType(n)&&(this[t]=n)}getProperty(t){return this[t]}getPropertyNames(){return Object.getOwnPropertyNames(this)}validate(){this.minSegments=Math.min(this.minSegments,this.maxSegments)}copy(){return lt.unserialize(this.serialize())}serialize(){return JSON.stringify(Object.assign({},this))}static unserialize(t){return new lt(JSON.parse(t))}}class Et{constructor(t,n,r,i=null,o=null,c){this.debugCanvasContext=null,this.trackCanvasContext=null,this.width=t,this.height=n,this.collisions=r,null!==o&&(this.trackCanvasContext=o.getContext("2d")),null!==i&&(this.debugCanvasContext=i.getContext("2d")),this.gates=c}drawPoint(t,n,r="#fff"){null!==t&&(t.fillStyle=r,t.fillRect(n[0]-1,n[1]-1,2,2))}drawGate(t,n,r="#f00",i="#0f0"){null!==t&&(this.drawPoint(t,n[0],r),this.drawPoint(t,n[1],i))}drawLine(t,n,r="#f00"){null!==t&&(t.strokeStyle=r,t.beginPath(),t.moveTo(n[0][0],n[0][1]),t.lineTo(n[1][0],n[1][1]),t.stroke())}serialize(){return JSON.stringify({width:this.width,height:this.height,collisions:this.collisions,gates:this.gates})}static unserialize(t){const n=JSON.parse(t);return new Et(n.width,n.height,n.collisions,null,null,n.gates)}firstGate(){return this.gates[0]}lastGate(){return this.gates[this.gates.length-1]}deleteLastGates(t){this.gates.splice(this.gates.length-t,t)}drawTrack(t=0,n=-1){if(null!==this.trackCanvasContext){this.trackCanvasContext.clearRect(0,0,this.width,this.height),n<0&&(n=this.gates.length);for(let r=t;r<n;r++)this.drawGate(this.trackCanvasContext,this.gates[r])}}}class Tt{constructor(t,n,r,i="random",o="",c=new lt){this.TWO_PI=2*Math.PI,this.track=t,this.startGate=n,this.endGate=r,this.mode=i,this.settings=c,""===o&&(o=(""+Math.random()).substring(2)),this.seed=o,this.random=ke(o)}pointEquals(t,n){return t[0]==n[0]&&t[1]==n[1]}lineEqualsStrict(t,n){return this.pointEquals(t[0],n[0])&&this.pointEquals(t[1],n[1])}gateCenterPos(t){return[t[0][0]+.5*(t[1][0]-t[0][0]),t[0][1]+.5*(t[1][1]-t[0][1])]}degreesToRadians(t){return t*(Math.PI/180)}normalizeAngle(t){return t-this.TWO_PI*Math.floor((t+Math.PI)/this.TWO_PI)}normalizeAngle10(t){return(t+Math.PI)/this.TWO_PI}vectorAngle(t){return Math.atan2(t[1],t[0])}angleToVector(t){return[Math.cos(t),Math.sin(t)]}angleToVectorMultiplied(t,n){return[Math.cos(t)*n,Math.sin(t)*n]}lineAngle(t){return this.vectorAngle([t[1][0]-t[0][0],t[1][1]-t[0][1]])}gateAngle(t){return this.normalizeAngle(this.lineAngle(t)-.5*Math.PI)}lineLengthUnnormed(t){const n=t[0][0]-t[1][0],r=t[0][1]-t[1][1];return n*n+r*r}lineLength(t){return Math.sqrt(this.lineLengthUnnormed(t))}pointToGate(t,n,r){return[this.pointTravel(t,n-.5*Math.PI,r),this.pointTravel(t,n+.5*Math.PI,r)]}pointTravel(t,n,r){return[t[0]+Math.cos(n)*r,t[1]+Math.sin(n)*r]}boundsLines(){return[[[0,0],[this.track.width,0]],[[0,0],[0,this.track.height]],[[this.track.width,this.track.height],[this.track.width,0]],[[this.track.width,this.track.height],[0,this.track.height]]]}pointOutBounds(t){return t[0]<0||t[1]<0||t[0]>this.track.width||t[1]>this.track.height}lineOutBounds(t){return this.pointOutBounds(t[0])||this.pointOutBounds(t[1])}lineIntersectionPoint(t,n){let j,P,G,r=t[0][0],i=t[0][1],o=t[1][0],c=t[1][1],h=n[0][0],x=n[0][1],p=n[1][0],O=n[1][1];return j=(o-r)*(O-x)-(p-h)*(c-i),0!==j&&(G=((O-x)*(p-r)+(h-p)*(O-i))/j,P=((i-c)*(p-r)+(o-r)*(O-i))/j,0<G&&G<1&&0<P&&P<1)?[r+G*(o-r),i+G*(c-i)]:null}gateHasCollision(t,n,r){for(let i of[[t[0],n[0]],[n[0],n[1]],[n[1],t[1]]]){const o=this.track.gates.concat(r);for(let c=o.length-1;c>1;c--)for(let h of[0,1])if(null!==this.lineIntersectionPoint([i[0],i[1]],[o[c][h],o[c-1][h]]))return!0}return!1}serialize(){return JSON.stringify({track:this.track.serialize(),start:this.startGate,end:this.endGate,mode:this.mode,seed:this.seed,settings:this.settings.serialize()})}static unserialize(t){const n=JSON.parse(t);return new Tt(Et.unserialize(n.track),n.start,n.end,n.mode,n.seed,lt.unserialize(n.settings))}calcMaxGateHalfSize(t,n){let o,r=this.pointToGate(t,n,this.track.width*this.track.height),i=+this.settings.maxGateHalfSize;const c=this.track.gates.concat(this.boundsLines());for(let h=c.length-1;h>1;h--)for(let x of[0,1])if(o=this.lineIntersectionPoint([r[0],r[1]],[c[h][x],c[h-1][x]]),null!==o){const p=this.lineLength([o,t]);(p<0||p<i)&&(i=p)}return i}predictDirections(t,n,r){const i=this.lineAngle([t,n]),o=[this.normalizeAngle(r)];for(let h=+this.settings.curveComputeCount-1;h>0;h--){const x=h*this.degreesToRadians(+this.settings.maxCurve)/+this.settings.curveComputeCount;o.push(this.normalizeAngle(r+x)),o.push(this.normalizeAngle(r-x))}o.sort((h,x)=>Math.abs(this.normalizeAngle(i-x))-Math.abs(this.normalizeAngle(i-h)));const c=[];for(const h of o)c.push(this.angleToVectorMultiplied(h,+this.settings.gateDistance));return c}randomShuffle(t){return t.sort(()=>.5-this.random())}pointAngleMatches(t,n,r,i){return!(this.lineLengthUnnormed([t,r])>19||Math.abs(this.normalizeAngle(n-i))>.3)}posAngleToGrid(t,n){return[Math.floor(t[1]*+this.settings.yComputeFactor),Math.floor(t[0]*+this.settings.xComputeFactor),Math.floor(this.normalizeAngle10(n)*+this.settings.angleComputeFactor)]}isValidGridPos(t,n){return t[0]>=0&&t[0]<n[0]&&t[1]>=0&&t[1]<n[1]&&t[2]>=0&&t[2]<n[2]}findTrackDFS(t=0,n=0){this.settings.validate();const r=[],i=this.gateCenterPos(this.endGate),o=this.gateAngle(this.endGate),c=this.posAngleToGrid([this.track.width,this.track.height],Math.PI);console.log(c);const h=new Array(c[0]);for(let x=0;x<c[0];x++){h[x]=new Array(c[1]);for(let p=0;p<c[1];p++){h[x][p]=new Array(c[2]);for(let O=0;O<c[2];O++)h[x][p][O]=!1}}for(r.push([this.startGate,[],0]);;){let x=r.pop();if(void 0===x)return n>=+this.settings.maxTrys-1?[[],!1,t]:(this.settings.angleComputeFactor+=1,this.findTrackDFS(t,n+1));const p=x[0],O=x[1];let j=x[2];const P=this.gateCenterPos(p),G=this.gateAngle(p),V=this.posAngleToGrid(P,G);h[V[0]][V[1]][V[2]]=!0,this.track.drawPoint(this.track.debugCanvasContext,P,"#fff");const $=this.pointAngleMatches(P,G,i,o),st=O.length;if($&&st>=+this.settings.minSegments||st>=+this.settings.maxSegments)return console.log(st+" segments"),console.log(j+" collisions"),[O,$,t];let H=this.predictDirections(P,i,G);switch(this.mode){case"worst":H=H.reverse();break;case"random":H=this.randomShuffle(H)}for(let Pt of H){const At=[P[0]+Pt[0],P[1]+Pt[1]],Ot=this.vectorAngle(Pt);let at=Math.min(+this.settings.maxGateHalfSize,this.calcMaxGateHalfSize(At,Ot));at>+this.settings.minGateHalfSize&&(at=+this.settings.minGateHalfSize+this.random()*(at-+this.settings.minGateHalfSize)),at=Math.max(+this.settings.minGateHalfSize,at);const Ct=this.pointToGate(At,Ot,at),pt=this.posAngleToGrid(At,Ot);this.isValidGridPos(pt,c)&&!h[pt[0]][pt[1]][pt[2]]&&!this.lineOutBounds(Ct)&&(this.gateHasCollision(p,Ct,O)&&(j+=1),j<=+this.settings.maxCollisions&&r.push([Ct,O.concat([p]),j]))}if(++t>+this.settings.maxIterations)return[[],!1,t]}}findTrackDFSWorker(t=!0){if(t&&"undefined"!=typeof Worker){const n=new Worker(g.tu(new URL(g.p+g.u(161),g.b))),r=bt(n,"message").pipe(function Me(e){return e<=0?()=>Kt:ct((t,n)=>{let r=0;t.subscribe(ut(n,i=>{++r<=e&&(n.next(i),e<=r&&n.complete())}))})}(1),dt(i=>(console.log(i.data),i.data)));return n.postMessage({type:"start",trackGenerator:this.serialize()}),r}return Ue(this.findTrackDFS())}generate(t=!0){const n=(new Date).getTime();return this.findTrackDFSWorker(t).pipe(dt(r=>{const i=(new Date).getTime()-n;if(0==r[0].length)return console.log("path was not found!"),[i,r[2]];const o=r[0];r[1]&&console.log("path is finished");const c=o.length;for(let h=0;h<c;h++)h>0&&this.track.gates.push(o[h]);return[i,r[2]]}))}}addEventListener("message",({data:e})=>{const t=Tt.unserialize(e.trackGenerator);postMessage(t.findTrackDFS())})},340:(v,A,g)=>{var E=g(471),F=g(992),w=g(657),U=g(583),M=g(929),I=g(83),S=g(818);S.alea=E,S.xor128=F,S.xorwow=w,S.xorshift7=U,S.xor4096=M,S.tychei=I,v.exports=S},471:function(v,A,g){var E;!function(F,w,U){function M(s){var l=this,f=function d(){var s=4022871197;return function(f){f=String(f);for(var a=0;a<f.length;a++){var u=.02519603282416938*(s+=f.charCodeAt(a));u-=s=u>>>0,s=(u*=s)>>>0,s+=4294967296*(u-=s)}return 2.3283064365386963e-10*(s>>>0)}}();l.next=function(){var a=2091639*l.s0+2.3283064365386963e-10*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=a-(l.c=0|a)},l.c=1,l.s0=f(" "),l.s1=f(" "),l.s2=f(" "),l.s0-=f(s),l.s0<0&&(l.s0+=1),l.s1-=f(s),l.s1<0&&(l.s1+=1),l.s2-=f(s),l.s2<0&&(l.s2+=1),f=null}function I(s,l){return l.c=s.c,l.s0=s.s0,l.s1=s.s1,l.s2=s.s2,l}function S(s,l){var f=new M(s),a=l&&l.state,u=f.next;return u.int32=function(){return 4294967296*f.next()|0},u.double=function(){return u()+11102230246251565e-32*(2097152*u()|0)},u.quick=u,a&&("object"==typeof a&&I(a,f),u.state=function(){return I(f,{})}),u}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(E=function(){return S}.call(A,g,A,w))&&(w.exports=E):this.alea=S}(0,v=g.nmd(v))},83:function(v,A,g){var E;!function(F,w,U){function M(d){var s=this,l="";s.next=function(){var a=s.b,u=s.c,y=s.d,m=s.a;return a=a<<25^a>>>7^u,u=u-y|0,y=y<<24^y>>>8^m,m=m-a|0,s.b=a=a<<20^a>>>12^u,s.c=u=u-y|0,s.d=y<<16^u>>>16^m,s.a=m-a|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,d===Math.floor(d)?(s.a=d/4294967296|0,s.b=0|d):l+=d;for(var f=0;f<l.length+20;f++)s.b^=0|l.charCodeAt(f),s.next()}function I(d,s){return s.a=d.a,s.b=d.b,s.c=d.c,s.d=d.d,s}function S(d,s){var l=new M(d),f=s&&s.state,a=function(){return(l.next()>>>0)/4294967296};return a.double=function(){do{var m=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},a.int32=l.next,a.quick=a,f&&("object"==typeof f&&I(f,l),a.state=function(){return I(l,{})}),a}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(E=function(){return S}.call(A,g,A,w))&&(w.exports=E):this.tychei=S}(0,v=g.nmd(v))},992:function(v,A,g){var E;!function(F,w,U){function M(d){var s=this,l="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var a=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^a^a>>>8},d===(0|d)?s.x=d:l+=d;for(var f=0;f<l.length+64;f++)s.x^=0|l.charCodeAt(f),s.next()}function I(d,s){return s.x=d.x,s.y=d.y,s.z=d.z,s.w=d.w,s}function S(d,s){var l=new M(d),f=s&&s.state,a=function(){return(l.next()>>>0)/4294967296};return a.double=function(){do{var m=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},a.int32=l.next,a.quick=a,f&&("object"==typeof f&&I(f,l),a.state=function(){return I(l,{})}),a}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(E=function(){return S}.call(A,g,A,w))&&(w.exports=E):this.xor128=S}(0,v=g.nmd(v))},929:function(v,A,g){var E;!function(F,w,U){function M(d){var s=this;s.next=function(){var y,m,f=s.w,a=s.X,u=s.i;return s.w=f=f+1640531527|0,m=a[u+34&127],y=a[u=u+1&127],m^=m<<13,y^=y<<17,m=a[u]=(m^=m>>>15)^(y^=y>>>12),s.i=u,m+(f^f>>>16)|0},function l(f,a){var u,y,m,k,_,N=[],it=128;for(a===(0|a)?(y=a,a=null):(a+="\0",y=0,it=Math.max(it,a.length)),m=0,k=-32;k<it;++k)a&&(y^=a.charCodeAt((k+32)%a.length)),0===k&&(_=y),y^=y<<10,y^=y>>>15,y^=y<<4,y^=y>>>13,k>=0&&(m=0==(u=N[127&k]^=y+(_=_+1640531527|0))?m+1:0);for(m>=128&&(N[127&(a&&a.length||0)]=-1),m=127,k=512;k>0;--k)y=N[m+34&127],u=N[m=m+1&127],y^=y<<13,u^=u<<17,N[m]=(y^=y>>>15)^(u^=u>>>12);f.w=_,f.X=N,f.i=m}(s,d)}function I(d,s){return s.i=d.i,s.w=d.w,s.X=d.X.slice(),s}function S(d,s){null==d&&(d=+new Date);var l=new M(d),f=s&&s.state,a=function(){return(l.next()>>>0)/4294967296};return a.double=function(){do{var m=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},a.int32=l.next,a.quick=a,f&&(f.X&&I(f,l),a.state=function(){return I(l,{})}),a}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(E=function(){return S}.call(A,g,A,w))&&(w.exports=E):this.xor4096=S}(0,v=g.nmd(v))},583:function(v,A,g){var E;!function(F,w,U){function M(d){var s=this;s.next=function(){var u,y,f=s.x,a=s.i;return u=f[a],y=(u^=u>>>7)^u<<24,y^=(u=f[a+1&7])^u>>>10,y^=(u=f[a+3&7])^u>>>3,y^=(u=f[a+4&7])^u<<7,u=f[a+7&7],f[a]=y^=(u^=u<<13)^u<<9,s.i=a+1&7,y},function l(f,a){var u,m=[];if(a===(0|a))m[0]=a;else for(a=""+a,u=0;u<a.length;++u)m[7&u]=m[7&u]<<15^a.charCodeAt(u)+m[u+1&7]<<13;for(;m.length<8;)m.push(0);for(u=0;u<8&&0===m[u];++u);for(8==u&&(m[7]=-1),f.x=m,f.i=0,u=256;u>0;--u)f.next()}(s,d)}function I(d,s){return s.x=d.x.slice(),s.i=d.i,s}function S(d,s){null==d&&(d=+new Date);var l=new M(d),f=s&&s.state,a=function(){return(l.next()>>>0)/4294967296};return a.double=function(){do{var m=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},a.int32=l.next,a.quick=a,f&&(f.x&&I(f,l),a.state=function(){return I(l,{})}),a}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(E=function(){return S}.call(A,g,A,w))&&(w.exports=E):this.xorshift7=S}(0,v=g.nmd(v))},657:function(v,A,g){var E;!function(F,w,U){function M(d){var s=this,l="";s.next=function(){var a=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^a^a<<1)|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,d===(0|d)?s.x=d:l+=d;for(var f=0;f<l.length+64;f++)s.x^=0|l.charCodeAt(f),f==l.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function I(d,s){return s.x=d.x,s.y=d.y,s.z=d.z,s.w=d.w,s.v=d.v,s.d=d.d,s}function S(d,s){var l=new M(d),f=s&&s.state,a=function(){return(l.next()>>>0)/4294967296};return a.double=function(){do{var m=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},a.int32=l.next,a.quick=a,f&&("object"==typeof f&&I(f,l),a.state=function(){return I(l,{})}),a}w&&w.exports?w.exports=S:g.amdD&&g.amdO?void 0!==(E=function(){return S}.call(A,g,A,w))&&(w.exports=E):this.xorwow=S}(0,v=g.nmd(v))},818:function(v,A,g){var E;!function(F,w,U){var u,M=256,s=U.pow(M,6),l=U.pow(2,52),f=2*l,a=255;function y(T,C,R){var z=[],D=N(_((C=1==C?{entropy:!0}:C||{}).entropy?[T,et(w)]:null==T?function it(){try{var T;return u&&(T=u.randomBytes)?T=T(M):(T=new Uint8Array(M),(F.crypto||F.msCrypto).getRandomValues(T)),et(T)}catch(z){var C=F.navigator,R=C&&C.plugins;return[+new Date,F,R,F.screen,et(w)]}}():T,3),z),B=new m(z),J=function(){for(var L=B.g(6),b=s,X=0;L<l;)L=(L+X)*M,b*=M,X=B.g(1);for(;L>=f;)L/=2,b/=2,X>>>=1;return(L+X)/b};return J.int32=function(){return 0|B.g(4)},J.quick=function(){return B.g(4)/4294967296},J.double=J,N(et(B.S),w),(C.pass||R||function(L,b,X,Y){return Y&&(Y.S&&k(Y,B),L.state=function(){return k(B,{})}),X?(U.random=L,b):L})(J,D,"global"in C?C.global:this==U,C.state)}function m(T){var C,R=T.length,z=this,D=0,B=z.i=z.j=0,J=z.S=[];for(R||(T=[R++]);D<M;)J[D]=D++;for(D=0;D<M;D++)J[D]=J[B=a&B+T[D%R]+(C=J[D])],J[B]=C;(z.g=function(L){for(var b,X=0,Y=z.i,Q=z.j,Z=z.S;L--;)b=Z[Y=a&Y+1],X=X*M+Z[a&(Z[Y]=Z[Q=a&Q+b])+(Z[Q]=b)];return z.i=Y,z.j=Q,X})(M)}function k(T,C){return C.i=T.i,C.j=T.j,C.S=T.S.slice(),C}function _(T,C){var D,R=[],z=typeof T;if(C&&"object"==z)for(D in T)try{R.push(_(T[D],C-1))}catch(B){}return R.length?R:"string"==z?T:T+"\0"}function N(T,C){for(var z,R=T+"",D=0;D<R.length;)C[a&D]=a&(z^=19*C[a&D])+R.charCodeAt(D++);return et(C)}function et(T){return String.fromCharCode.apply(0,T)}if(N(U.random(),w),v.exports){v.exports=y;try{u=g(42)}catch(T){}}else void 0!==(E=function(){return y}.call(A,g,A,v))&&(v.exports=E)}("undefined"!=typeof self?self:this,[],Math)},42:()=>{}},It={};function W(v){var A=It[v];if(void 0!==A)return A.exports;var g=It[v]={id:v,loaded:!1,exports:{}};return Mt[v].call(g.exports,g,g.exports,W),g.loaded=!0,g.exports}W.m=Mt,W.amdD=function(){throw new Error("define cannot be used indirect")},W.amdO={},W.u=v=>v+".51f419bff4540783.js",W.o=(v,A)=>Object.prototype.hasOwnProperty.call(v,A),W.nmd=v=>(v.paths=[],v.children||(v.children=[]),v),W.tt=()=>(void 0===v&&(v={createScriptURL:A=>A},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(v=trustedTypes.createPolicy("angular#bundler",v))),v),W.tu=v=>W.tt().createScriptURL(v),W.p="",W.b=self.location+"",W(161)})();