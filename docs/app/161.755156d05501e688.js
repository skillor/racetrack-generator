(()=>{var w,Tt={161:(w,A,m)=>{"use strict";function G(n){return this instanceof G?(this.v=n,this):new G(n)}function Y(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=e.apply(n,t||[]),s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(T){r[T]&&(i[T]=function(R){return new Promise(function(J,Z){s.push([T,R,J,Z])>1||c(T,R)})})}function c(T,R){try{!function y(T){T.value instanceof G?Promise.resolve(T.value.v).then(h,b):z(s[0][2],T)}(r[T](R))}catch(J){z(s[0][3],J)}}function h(T){c("next",T)}function b(T){c("throw",T)}function z(T,R){T(R),s.shift(),s.length&&c(s[0][0],s[0][1])}}function rt(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function l(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(s){e[s]=n[s]&&function(a){return new Promise(function(c,y){!function i(s,a,c,y){Promise.resolve(y).then(function(h){s({value:h,done:c})},a)}(c,y,(a=n[s](a)).done,a.value)})}}}const F=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function P(n){return"function"==typeof n}function V(n){return P(null==n?void 0:n.then)}const q=function $(n){const e=n(r=>{Error.call(r),r.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function tt(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class et{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:r}=this;if(P(r))try{r()}catch(s){t=s instanceof q?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{Lt(s)}catch(a){t=null!=t?t:[],a instanceof q?t=[...t,...a.errors]:t.push(a)}}if(t)throw new q(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Lt(t);else{if(t instanceof et){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&tt(e,t)}remove(t){const{_finalizers:e}=this;e&&tt(e,t),t instanceof et&&t._removeParent(this)}}function It(n){return n instanceof et||n&&"closed"in n&&P(n.remove)&&P(n.add)&&P(n.unsubscribe)}function Lt(n){P(n)?n():n.unsubscribe()}et.EMPTY=(()=>{const n=new et;return n.closed=!0,n})();const it={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},dt={setTimeout(n,t,...e){const{delegate:r}=dt;return(null==r?void 0:r.setTimeout)?r.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=dt;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function Dt(n){dt.setTimeout(()=>{const{onUnhandledError:t}=it;if(!t)throw n;t(n)})}function jt(){}const Qt=wt("C",void 0,void 0);function wt(n,t,e){return{kind:n,value:t,error:e}}let st=null;class xt extends et{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,It(t)&&t.add(this)):this.destination=se}static create(t,e,r){return new Pt(t,e,r)}next(t){this.isStopped?St(function qt(n){return wt("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?St(function Zt(n){return wt("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?St(Qt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ne=Function.prototype.bind;function bt(n,t){return ne.call(n,t)}class re{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(r){yt(r)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(r){yt(r)}else yt(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){yt(e)}}}class Pt extends xt{constructor(t,e,r){let i;if(super(),P(t)||!t)i={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=r?r:void 0};else{let s;this&&it.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),i={next:t.next&&bt(t.next,s),error:t.error&&bt(t.error,s),complete:t.complete&&bt(t.complete,s)}):i=t}this.destination=new re(i)}}function yt(n){it.useDeprecatedSynchronousErrorHandling?function ee(n){it.useDeprecatedSynchronousErrorHandling&&st&&(st.errorThrown=!0,st.error=n)}(n):Dt(n)}function St(n,t){const{onStoppedNotification:e}=it;e&&dt.setTimeout(()=>e(n,t))}const se={closed:!0,next:jt,error:function ie(n){throw n},complete:jt},Mt="function"==typeof Symbol&&Symbol.observable||"@@observable";function oe(n){return n}let N=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const r=new n;return r.source=this,r.operator=e,r}subscribe(e,r,i){const s=function le(n){return n&&n instanceof xt||function ae(n){return n&&P(n.next)&&P(n.error)&&P(n.complete)}(n)&&It(n)}(e)?e:new Pt(e,r,i);return function te(n){if(it.useDeprecatedSynchronousErrorHandling){const t=!st;if(t&&(st={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:r}=st;if(st=null,e)throw r}}else n()}(()=>{const{operator:a,source:c}=this;s.add(a?a.call(s,c):c?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return new(r=Rt(r))((i,s)=>{const a=new Pt({next:c=>{try{e(c)}catch(y){s(y),a.unsubscribe()}},error:s,complete:i});this.subscribe(a)})}_subscribe(e){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(e)}[Mt](){return this}pipe(...e){return function zt(n){return 0===n.length?oe:1===n.length?n[0]:function(e){return n.reduce((r,i)=>i(r),e)}}(e)(this)}toPromise(e){return new(e=Rt(e))((r,i)=>{let s;this.subscribe(a=>s=a,a=>i(a),()=>r(s))})}}return n.create=t=>new n(t),n})();function Rt(n){var t;return null!==(t=null!=n?n:it.Promise)&&void 0!==t?t:Promise}function Gt(n){return P(n[Mt])}function Ft(n){return Symbol.asyncIterator&&P(null==n?void 0:n[Symbol.asyncIterator])}function Bt(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ut=function ce(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ht(n){return P(null==n?void 0:n[Ut])}function Wt(n){return Y(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:r,done:i}=yield G(e.read());if(i)return yield G(void 0);yield yield G(r)}}finally{e.releaseLock()}})}function Xt(n){return P(null==n?void 0:n.getReader)}function at(n){if(n instanceof N)return n;if(null!=n){if(Gt(n))return function ue(n){return new N(t=>{const e=n[Mt]();if(P(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(F(n))return function fe(n){return new N(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(V(n))return function he(n){return new N(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Dt)})}(n);if(Ft(n))return _t(n);if(Ht(n))return function de(n){return new N(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(Xt(n))return function ye(n){return _t(Wt(n))}(n)}throw Bt(n)}function _t(n){return new N(t=>{(function ge(n,t){var e,r,i,s;return function g(n,t,e,r){return new(e||(e=Promise))(function(s,a){function c(b){try{h(r.next(b))}catch(z){a(z)}}function y(b){try{h(r.throw(b))}catch(z){a(z)}}function h(b){b.done?s(b.value):function i(s){return s instanceof e?s:new e(function(a){a(s)})}(b.value).then(c,y)}h((r=r.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=rt(n);!(r=yield e.next()).done;)if(t.next(r.value),t.closed)return}catch(a){i={error:a}}finally{try{r&&!r.done&&(s=e.return)&&(yield s.call(e))}finally{if(i)throw i.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function ct(n){return t=>{if(function pe(n){return P(null==n?void 0:n.lift)}(t))return t.lift(function(e){try{return n(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ut(n,t,e,r,i){return new me(n,t,e,r,i)}class me extends xt{constructor(t,e,r,i,s,a){super(t),this.onFinalize=s,this.shouldUnsubscribe=a,this._next=e?function(c){try{e(c)}catch(y){t.error(y)}}:super._next,this._error=i?function(c){try{i(c)}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(c){t.error(c)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function gt(n,t){return ct((e,r)=>{let i=0;e.subscribe(ut(r,s=>{r.next(n.call(t,s,i++))}))})}function nt(n,t,e,r=0,i=!1){const s=t.schedule(function(){e(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function Vt(n,t,e=1/0){return P(t)?Vt((r,i)=>gt((s,a)=>t(r,s,i,a))(at(n(r,i))),e):("number"==typeof t&&(e=t),ct((r,i)=>function ve(n,t,e,r,i,s,a,c){const y=[];let h=0,b=0,z=!1;const T=()=>{z&&!y.length&&!h&&t.complete()},R=Z=>h<r?J(Z):y.push(Z),J=Z=>{s&&t.next(Z),h++;let lt=!1;at(e(Z,b++)).subscribe(ut(t,K=>{null==i||i(K),s?R(K):t.next(K)},()=>{lt=!0},void 0,()=>{if(lt)try{for(h--;y.length&&h<r;){const K=y.shift();a?nt(t,a,()=>J(K)):J(K)}T()}catch(K){t.error(K)}}))};return n.subscribe(ut(t,R,()=>{z=!0,T()})),()=>{null==c||c()}}(r,i,n,e)))}const{isArray:we}=Array;const Pe=["addListener","removeListener"],Se=["addEventListener","removeEventListener"],Me=["on","off"];function Et(n,t,e,r){if(P(e)&&(r=e,e=void 0),r)return Et(n,t,e).pipe(function be(n){return gt(t=>function xe(n,t){return we(t)?n(...t):n(t)}(n,t))}(r));const[i,s]=function Oe(n){return P(n.addEventListener)&&P(n.removeEventListener)}(n)?Se.map(a=>c=>n[a](t,c,e)):function Ee(n){return P(n.addListener)&&P(n.removeListener)}(n)?Pe.map(Yt(n,t)):function Ae(n){return P(n.on)&&P(n.off)}(n)?Me.map(Yt(n,t)):[];if(!i&&F(n))return Vt(a=>Et(a,t,e))(at(n));if(!i)throw new TypeError("Invalid event target");return new N(a=>{const c=(...y)=>a.next(1<y.length?y:y[0]);return i(c),()=>s(c)})}function Yt(n,t){return e=>r=>n[e](t,r)}const kt=new N(n=>n.complete());function Nt(n,t=0){return ct((e,r)=>{e.subscribe(ut(r,i=>nt(r,n,()=>r.next(i),t),()=>nt(r,n,()=>r.complete(),t),i=>nt(r,n,()=>r.error(i),t)))})}function Jt(n,t=0){return ct((e,r)=>{r.add(n.schedule(()=>e.subscribe(r),t))})}function Kt(n,t){if(!n)throw new Error("Iterable cannot be null");return new N(e=>{nt(e,t,()=>{const r=n[Symbol.asyncIterator]();nt(e,t,()=>{r.next().then(i=>{i.done?e.complete():e.next(i.value)})},0,!0)})})}function Ue(...n){return function Be(n,t){return t?function Fe(n,t){if(null!=n){if(Gt(n))return function De(n,t){return at(n).pipe(Jt(t),Nt(t))}(n,t);if(F(n))return function ze(n,t){return new N(e=>{let r=0;return t.schedule(function(){r===n.length?e.complete():(e.next(n[r++]),e.closed||this.schedule())})})}(n,t);if(V(n))return function je(n,t){return at(n).pipe(Jt(t),Nt(t))}(n,t);if(Ft(n))return Kt(n,t);if(Ht(n))return function Re(n,t){return new N(e=>{let r;return nt(e,t,()=>{r=n[Ut](),nt(e,t,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(a){return void e.error(a)}s?e.complete():e.next(i)},0,!0)}),()=>P(null==r?void 0:r.return)&&r.return()})}(n,t);if(Xt(n))return function Ge(n,t){return Kt(Wt(n),t)}(n,t)}throw Bt(n)}(n,t):at(n)}(n,function Le(n){return function Ie(n){return n&&P(n.schedule)}(function At(n){return n[n.length-1]}(n))?n.pop():void 0}(n))}var He=m(340);class ft{constructor(t={}){this.minSegments=5,this.maxSegments=1e5,this.xComputeFactor=.5,this.yComputeFactor=.5,this.angleComputeFactor=9,this.maxTrys=20,this.maxCurve=45,this.gateDistance=10,this.curveComputeCount=4,this.maxIterations=1e6,this.minGateHalfSize=5,this.maxGateHalfSize=15,this.maxCollisions=0,this.distanceMatch=19,this.angleMatch=.3;for(const e of this.getPropertyNames()){let r=t[e];"number"===this.getType(this.getProperty(e))&&(r=+r),this.setProperty(e,r)}}getType(t){return typeof t}setProperty(t,e){this.getType(this.getProperty(t))===this.getType(e)&&(this[t]=e)}getProperty(t){return this[t]}getPropertyNames(){return Object.getOwnPropertyNames(this)}validate(){this.minSegments=Math.min(this.minSegments,this.maxSegments)}copy(){return ft.unserialize(this.serialize())}serialize(){return JSON.stringify(Object.assign({},this))}static unserialize(t){return new ft(JSON.parse(t))}}class Q{constructor(t,e,r,i=null,s=null,a,c=[]){this.debugCanvasContext=null,this.trackCanvasContext=null,this.barrierLines=void 0,this.width=t,this.height=e,this.collisions=r,null!==s&&(this.trackCanvasContext=s.getContext("2d")),null!==i&&(this.debugCanvasContext=i.getContext("2d")),this.gates=a,this.deletedBarriers=c}static drawPoint(t,e,r="#fff"){null!==t&&(t.fillStyle=r,t.fillRect(e[0]-1,e[1]-1,2,2))}static drawGate(t,e,r="#f00",i="#0f0"){null!==t&&(this.drawPoint(t,e[0],r),this.drawPoint(t,e[1],i))}static drawLine(t,e,r="#f00"){null!==t&&(t.strokeStyle=r,t.lineWidth=1,t.beginPath(),t.moveTo(e[0][0],e[0][1]),t.lineTo(e[1][0],e[1][1]),t.closePath(),t.stroke())}static drawPolygon(t,e,r="#fff",i=null){if(null!==t&&0!=e.length){null!==r&&(t.fillStyle=r),null!==i&&(t.strokeStyle=i,t.lineWidth=1),t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(let s=1;s<e.length;s++)t.lineTo(e[s][0],e[s][1]);t.lineTo(e[0][0],e[0][1]),t.closePath(),null!==r&&t.fill(),null!==i&&t.stroke()}}static drawGateArrow(t,e,r,i="#fff"){if(null===t)return;t.strokeStyle=i,t.lineWidth=1;let s=C.gateAngle(e),a=C.centerOfLine(e),c=C.angleToVectorMultiplied(s,r),y=[a[0]+c[0],a[1]+c[1]];if(r<0){let h=a;a=y,y=h,s+=Math.PI}t.beginPath(),t.moveTo(a[0],a[1]),t.lineTo(y[0],y[1]),c=C.angleToVectorMultiplied(s+.3,.8*r),t.lineTo(a[0]+c[0],a[1]+c[1]),t.moveTo(y[0],y[1]),c=C.angleToVectorMultiplied(s-.3,.8*r),t.lineTo(a[0]+c[0],a[1]+c[1]),t.closePath(),t.stroke()}serialize(){return JSON.stringify({width:this.width,height:this.height,collisions:this.collisions,gates:this.gates,deletedBarriers:this.deletedBarriers})}static unserialize(t){const e=JSON.parse(t);return new Q(e.width,e.height,e.collisions,null,null,e.gates,e.deletedBarriers)}calculateBarrierLines(){this.barrierLines={left:[],right:[]};for(let t=this.gates.length-1;t>1;t--)for(let e of[0,1]){let r=this.barrierLines.left;1==e&&(r=this.barrierLines.right),r.push([this.gates[t][e],this.gates[t-1][e]])}}getBarrierLines(){return void 0===this.barrierLines&&this.calculateBarrierLines(),this.barrierLines}firstGate(){return this.gates[0]}lastGate(){return this.gates[this.gates.length-1]}deleteLastGates(t){this.gates.splice(this.gates.length-t,t)}drawBarrierLines(t,e="#fff"){const r=this.getBarrierLines();for(let i=0;i<r.left.length;i++)this.deletedBarriers.includes(2*i)||Q.drawLine(t,r.left[i],e);for(let i=0;i<r.right.length;i++)this.deletedBarriers.includes(2*i+1)||Q.drawLine(t,r.right[i],e)}drawTrack(t=0,e=-1){if(null!==this.trackCanvasContext){this.trackCanvasContext.clearRect(0,0,this.width,this.height),Q.drawGateArrow(this.trackCanvasContext,this.firstGate(),10,"#0f0"),Q.drawGateArrow(this.trackCanvasContext,this.lastGate(),-10,"#f00"),e<0&&(e=this.gates.length),this.drawBarrierLines(this.trackCanvasContext,"#fff");for(let r=t;r<e;r++)Q.drawGate(this.trackCanvasContext,this.gates[r])}}}class C{constructor(t,e,r,i="random",s="",a=new ft){this.track=t,this.startGate=e,this.endGate=r,this.mode=i,this.settings=a,this.seed=s,this.random=He(s)}static colorMatch(t,e){return t[0]==e[0]&&t[1]==e[1]&&t[2]==e[2]}static pointEquals(t,e){return t[0]==e[0]&&t[1]==e[1]}static lineEqualsStrict(t,e){return this.pointEquals([t[0][0],t[0][1]],[e[0][0],e[0][1]])&&this.pointEquals([t[1][0],t[1][1]],[e[1][0],e[1][1]])}lineCenterPos(t){return[t[0][0]+.5*(t[1][0]-t[0][0]),t[0][1]+.5*(t[1][1]-t[0][1])]}degreesToRadians(t){return t*(Math.PI/180)}static normalizeAngle(t){return t-this.TWO_PI*Math.floor((t+Math.PI)/this.TWO_PI)}static normalizeAngle10(t){return(t+Math.PI)/this.TWO_PI}static vectorAngle(t){return Math.atan2(t[1],t[0])}static angleToVector(t){return[Math.cos(t),Math.sin(t)]}static angleToVectorMultiplied(t,e){return[Math.cos(t)*e,Math.sin(t)*e]}static lineAngle(t){return this.vectorAngle([t[1][0]-t[0][0],t[1][1]-t[0][1]])}static gateAngle(t){return this.normalizeAngle(this.lineAngle(t)-.5*Math.PI)}static rotatePoint(t,e){const r=Math.cos(e),i=Math.sin(e);return[r*t[0]-i*t[1],i*t[0]+r*t[1]]}static addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}static rotatedRect(t,e,r){return[this.addPoints(t,this.rotatePoint(e,r)),this.addPoints(t,this.rotatePoint([e[0],-e[1]],r)),this.addPoints(t,this.rotatePoint([-e[0],-e[1]],r)),this.addPoints(t,this.rotatePoint([-e[0],e[1]],r))]}static lineLengthUnnormed(t){const e=t[0][0]-t[1][0],r=t[0][1]-t[1][1];return e*e+r*r}static lineLength(t){return Math.sqrt(this.lineLengthUnnormed(t))}static pointToGate(t,e,r,i=!1){return[this.pointTravel(t,e-.5*Math.PI,r,i),this.pointTravel(t,e+.5*Math.PI,r,i)]}static pointTravel(t,e,r,i=!1){const s=[t[0]+Math.cos(e)*r,t[1]+Math.sin(e)*r];return i&&(s[0]=Math.round(s[0]),s[1]=Math.round(s[1])),s}boundsLines(){return[[[0,0],[this.track.width,0]],[[0,0],[0,this.track.height]],[[this.track.width,this.track.height],[this.track.width,0]],[[this.track.width,this.track.height],[0,this.track.height]]]}pointOutBounds(t){return t[0]<0||t[1]<0||t[0]>this.track.width||t[1]>this.track.height}static centerOfLine(t){return[.5*(t[0][0]+t[1][0]),.5*(t[0][1]+t[1][1])]}lineOutBounds(t){return this.pointOutBounds(t[0])||this.pointOutBounds(t[1])}lineIntersectionPoint(t,e){let z,T,R,r=t[0][0],i=t[0][1],s=t[1][0],a=t[1][1],c=e[0][0],y=e[0][1],h=e[1][0],b=e[1][1];return z=(s-r)*(b-y)-(h-c)*(a-i),0!==z&&(R=((b-y)*(h-r)+(c-h)*(b-i))/z,T=((i-a)*(h-r)+(s-r)*(b-i))/z,0<R&&R<1&&0<T&&T<1)?[r+R*(s-r),i+R*(a-i)]:null}gateHasCollision(t,e,r){const i=[[t[0],e[0]],[e[0],e[1]],[e[1],t[1]]];if(this.hasPolyPixelCollision([t[0],e[0],e[1],t[1]]))return!0;for(let s of i){const a=this.track.gates.concat(r);for(let c=a.length-1;c>1;c--)for(let y of[0,1])if(null!==this.lineIntersectionPoint([s[0],s[1]],[a[c][y],a[c-1][y]]))return!0}return!1}getLineBounds(t){return[Math.min(t[0][1],t[1][1]),Math.min(t[0][0],t[1][0]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]}getLinesBounds(t){let e=1/0,r=1/0,i=-1/0,s=-1/0;for(const a of t)e=Math.min(e,a[0][1],a[1][1]),r=Math.min(r,a[0][0],a[1][0]),i=Math.max(i,a[0][0],a[1][0]),s=Math.max(s,a[0][1],a[1][1]);return[e,r,i,s]}hasRectangleCollision(t,e){return t[1]<e[2]&&t[2]>e[1]&&t[0]<e[3]&&t[3]>e[0]}lineIsValidY(t,e){return t>=e[0][1]&&t<e[1][1]||t>=e[1][1]&&t<e[0][1]}lineGetM(t){return(t[1][1]-t[0][1])/(t[1][0]-t[0][0])}lineGetX(t,e){return 1/this.lineGetM(e)*(t-e[0][1])+e[0][0]}getLinesMeetY(t,e){let r=[];for(let i=0;i<e.length;i++){const s=e[i];this.lineIsValidY(t,s)&&r.push(this.lineGetX(t,s))}for(let i=0;i<r.length;i++)for(let s=i;s<r.length;s++)if(r[i]>r[s]){let a=r[i];r[i]=r[s],r[s]=a}return r}hasPolyPixelCollision(t){const e=[];for(let a=1;a<t.length;a++)e.push([t[a-1],t[a]]);e.push([t[t.length-1],t[0]]);const r=this.getLinesBounds(e),i=Math.floor(r[0]),s=Math.ceil(r[3]);Q.drawPolygon(this.track.debugCanvasContext,t,null,"#f00");for(let a=i;a<s;a++){const c=this.getLinesMeetY(a,e);for(let y=1;y<c.length;y+=2){const h=Math.ceil(c[y]);for(let b=Math.floor(c[y-1]);b<h;b++)if(this.pointOutBounds([b,a])||this.track.collisions[a][b])return!0}}return!1}getLinePixelCollisions(t){const e=this.lineCenterPos(t),r=C.angleToVectorMultiplied(C.lineAngle(t),1);let i=e;const s=[];for(let a of[-1,1])for(;;){const c=[Math.floor(i[0]),Math.floor(i[1])];if(this.pointOutBounds(c))break;try{if(this.track.collisions[c[1]][c[0]]){s.push(i);break}}catch(y){s.push(i);break}i=[i[0]+r[0]*a,i[1]+r[1]*a]}return s}serialize(){return JSON.stringify({track:this.track.serialize(),start:this.startGate,end:this.endGate,mode:this.mode,seed:this.seed,settings:this.settings.serialize()})}static unserialize(t){const e=JSON.parse(t);return new C(Q.unserialize(e.track),e.start,e.end,e.mode,e.seed,ft.unserialize(e.settings))}calcMaxGateHalfSize(t,e){let s,r=C.pointToGate(t,e,this.track.width*this.track.height),i=+this.settings.maxGateHalfSize;const a=this.track.gates.concat(this.boundsLines()),c=[];for(let y=a.length-1;y>1;y--)for(let h of[0,1])c.push([a[y][h],a[y-1][h]]);for(let y of c)if(s=this.lineIntersectionPoint(r,y),null!==s){const h=C.lineLength([s,t]);if(h<0)return 0;h<i&&(i=h)}for(let y of this.getLinePixelCollisions(r)){const h=C.lineLength([y,t]);if(h<0)return 0;h<i&&(i=h)}return i}predictDirections(t,e,r){const i=C.lineAngle([t,e]),s=[C.normalizeAngle(r)];for(let c=+this.settings.curveComputeCount-1;c>0;c--){const y=c*this.degreesToRadians(+this.settings.maxCurve)/+this.settings.curveComputeCount;s.push(C.normalizeAngle(r+y)),s.push(C.normalizeAngle(r-y))}s.sort((c,y)=>Math.abs(C.normalizeAngle(i-y))-Math.abs(C.normalizeAngle(i-c)));const a=[];for(const c of s){const y=C.angleToVectorMultiplied(c,+this.settings.gateDistance),h=[Math.floor(t[0]+y[0]),Math.floor(t[1]+y[1])];let b=Math.min(+this.settings.maxGateHalfSize,this.calcMaxGateHalfSize(h,c)-1);+this.settings.minGateHalfSize>=0&&b>+this.settings.minGateHalfSize&&(b=+this.settings.minGateHalfSize+this.random()*(b-+this.settings.minGateHalfSize)),b=Math.max(+this.settings.minGateHalfSize,b),a.push([h,c,b])}return a}pointAngleMatches(t,e,r,i){return!(C.lineLengthUnnormed([t,r])>+this.settings.distanceMatch||Math.abs(C.normalizeAngle(e-i))>+this.settings.angleMatch)}posAngleToGrid(t,e){return[Math.floor(t[1]*+this.settings.yComputeFactor),Math.floor(t[0]*+this.settings.xComputeFactor),Math.floor(C.normalizeAngle10(e)*+this.settings.angleComputeFactor)]}isValidGridPos(t,e){return t[0]>=0&&t[0]<e[0]&&t[1]>=0&&t[1]<e[1]&&t[2]>=0&&t[2]<e[2]}findTrackDFS(t=0,e=0){this.settings.validate();const r=[],i=this.lineCenterPos(this.endGate),s=C.gateAngle(this.endGate),a=this.posAngleToGrid([this.track.width,this.track.height],Math.PI);console.log(a);const c=new Array(a[0]);for(let y=0;y<a[0];y++){c[y]=new Array(a[1]);for(let h=0;h<a[1];h++){c[y][h]=new Array(a[2]);for(let b=0;b<a[2];b++)c[y][h][b]=!1}}for(r.push([this.startGate,[],0]);;){let y=r.pop();if(void 0===y)return e>=+this.settings.maxTrys-1?[[],!1,t]:(this.settings.angleComputeFactor+=1,this.findTrackDFS(t,e+1));const h=y[0],b=y[1];let z=y[2];const T=this.lineCenterPos(h),R=C.gateAngle(h),J=this.posAngleToGrid(T,R);c[J[0]][J[1]][J[2]]=!0,Q.drawPoint(this.track.debugCanvasContext,T,"#fff");const Z=this.pointAngleMatches(T,R,i,s),lt=b.length,K=Z&&lt>=+this.settings.minSegments;if(K||lt>=+this.settings.maxSegments)return K&&b.push(this.endGate),console.log(lt+" segments"),console.log(z+" collisions"),[b,Z,t];let pt=this.predictDirections(T,i,R);switch(this.mode){case"longest":pt.reverse();break;case"random":pt.sort(()=>.5-this.random());break;case"maxwidth":pt.sort((ht,mt)=>ht[2]-mt[2])}for(let ht of pt){const mt=ht[0],$t=ht[1],Ot=C.pointToGate(mt,$t,ht[2]),vt=this.posAngleToGrid(mt,$t);this.isValidGridPos(vt,a)&&!c[vt[0]][vt[1]][vt[2]]&&!this.lineOutBounds(Ot)&&(this.gateHasCollision(h,Ot,b)&&(z+=1),z<=+this.settings.maxCollisions&&r.push([Ot,b.concat([h]),z]))}if(++t>+this.settings.maxIterations)return[[],!1,t]}}findTrackDFSWorker(t=!0){if(t&&"undefined"!=typeof Worker){const e=new Worker(m.tu(new URL(m.p+m.u(161),m.b))),r=Et(e,"message").pipe(function Ce(n){return n<=0?()=>kt:ct((t,e)=>{let r=0;t.subscribe(ut(e,i=>{++r<=n&&(e.next(i),n<=r&&e.complete())}))})}(1),gt(i=>(console.log(i.data),i.data)));return e.postMessage({type:"start",trackGenerator:this.serialize()}),r}return Ue(this.findTrackDFS())}generate(t=!0){const e=(new Date).getTime();return this.findTrackDFSWorker(t).pipe(gt(r=>{const i=(new Date).getTime()-e;if(0==r[0].length)return console.log("path was not found!"),[i,r[2]];const s=r[0];r[1]&&console.log("path is finished");const a=s.length;for(let c=0;c<a;c++)c>0&&this.track.gates.push(s[c]);return[i,r[2]]}))}}C.TWO_PI=2*Math.PI,addEventListener("message",({data:n})=>{const t=C.unserialize(n.trackGenerator);postMessage(t.findTrackDFS())})},340:(w,A,m)=>{var M=m(471),U=m(992),x=m(657),H=m(583),I=m(929),L=m(83),S=m(818);S.alea=M,S.xor128=U,S.xorwow=x,S.xorshift7=H,S.xor4096=I,S.tychei=L,w.exports=S},471:function(w,A,m){var M;!function(U,x,H){function I(o){var f=this,d=function g(){var o=4022871197;return function(d){d=String(d);for(var l=0;l<d.length;l++){var u=.02519603282416938*(o+=d.charCodeAt(l));u-=o=u>>>0,o=(u*=o)>>>0,o+=4294967296*(u-=o)}return 2.3283064365386963e-10*(o>>>0)}}();f.next=function(){var l=2091639*f.s0+2.3283064365386963e-10*f.c;return f.s0=f.s1,f.s1=f.s2,f.s2=l-(f.c=0|l)},f.c=1,f.s0=d(" "),f.s1=d(" "),f.s2=d(" "),f.s0-=d(o),f.s0<0&&(f.s0+=1),f.s1-=d(o),f.s1<0&&(f.s1+=1),f.s2-=d(o),f.s2<0&&(f.s2+=1),d=null}function L(o,f){return f.c=o.c,f.s0=o.s0,f.s1=o.s1,f.s2=o.s2,f}function S(o,f){var d=new I(o),l=f&&f.state,u=d.next;return u.int32=function(){return 4294967296*d.next()|0},u.double=function(){return u()+11102230246251565e-32*(2097152*u()|0)},u.quick=u,l&&("object"==typeof l&&L(l,d),u.state=function(){return L(d,{})}),u}x&&x.exports?x.exports=S:m.amdD&&m.amdO?void 0!==(M=function(){return S}.call(A,m,A,x))&&(x.exports=M):this.alea=S}(0,w=m.nmd(w))},83:function(w,A,m){var M;!function(U,x,H){function I(g){var o=this,f="";o.next=function(){var l=o.b,u=o.c,p=o.d,v=o.a;return l=l<<25^l>>>7^u,u=u-p|0,p=p<<24^p>>>8^v,v=v-l|0,o.b=l=l<<20^l>>>12^u,o.c=u=u-p|0,o.d=p<<16^u>>>16^v,o.a=v-l|0},o.a=0,o.b=0,o.c=-1640531527,o.d=1367130551,g===Math.floor(g)?(o.a=g/4294967296|0,o.b=0|g):f+=g;for(var d=0;d<f.length+20;d++)o.b^=0|f.charCodeAt(d),o.next()}function L(g,o){return o.a=g.a,o.b=g.b,o.c=g.c,o.d=g.d,o}function S(g,o){var f=new I(g),d=o&&o.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,d&&("object"==typeof d&&L(d,f),l.state=function(){return L(f,{})}),l}x&&x.exports?x.exports=S:m.amdD&&m.amdO?void 0!==(M=function(){return S}.call(A,m,A,x))&&(x.exports=M):this.tychei=S}(0,w=m.nmd(w))},992:function(w,A,m){var M;!function(U,x,H){function I(g){var o=this,f="";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var l=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^l^l>>>8},g===(0|g)?o.x=g:f+=g;for(var d=0;d<f.length+64;d++)o.x^=0|f.charCodeAt(d),o.next()}function L(g,o){return o.x=g.x,o.y=g.y,o.z=g.z,o.w=g.w,o}function S(g,o){var f=new I(g),d=o&&o.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,d&&("object"==typeof d&&L(d,f),l.state=function(){return L(f,{})}),l}x&&x.exports?x.exports=S:m.amdD&&m.amdO?void 0!==(M=function(){return S}.call(A,m,A,x))&&(x.exports=M):this.xor128=S}(0,w=m.nmd(w))},929:function(w,A,m){var M;!function(U,x,H){function I(g){var o=this;o.next=function(){var p,v,d=o.w,l=o.X,u=o.i;return o.w=d=d+1640531527|0,v=l[u+34&127],p=l[u=u+1&127],v^=v<<13,p^=p<<17,v=l[u]=(v^=v>>>15)^(p^=p>>>12),o.i=u,v+(d^d>>>16)|0},function f(d,l){var u,p,v,W,G,Y=[],ot=128;for(l===(0|l)?(p=l,l=null):(l+="\0",p=0,ot=Math.max(ot,l.length)),v=0,W=-32;W<ot;++W)l&&(p^=l.charCodeAt((W+32)%l.length)),0===W&&(G=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,W>=0&&(v=0==(u=Y[127&W]^=p+(G=G+1640531527|0))?v+1:0);for(v>=128&&(Y[127&(l&&l.length||0)]=-1),v=127,W=512;W>0;--W)p=Y[v+34&127],u=Y[v=v+1&127],p^=p<<13,u^=u<<17,Y[v]=(p^=p>>>15)^(u^=u>>>12);d.w=G,d.X=Y,d.i=v}(o,g)}function L(g,o){return o.i=g.i,o.w=g.w,o.X=g.X.slice(),o}function S(g,o){null==g&&(g=+new Date);var f=new I(g),d=o&&o.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,d&&(d.X&&L(d,f),l.state=function(){return L(f,{})}),l}x&&x.exports?x.exports=S:m.amdD&&m.amdO?void 0!==(M=function(){return S}.call(A,m,A,x))&&(x.exports=M):this.xor4096=S}(0,w=m.nmd(w))},583:function(w,A,m){var M;!function(U,x,H){function I(g){var o=this;o.next=function(){var u,p,d=o.x,l=o.i;return u=d[l],p=(u^=u>>>7)^u<<24,p^=(u=d[l+1&7])^u>>>10,p^=(u=d[l+3&7])^u>>>3,p^=(u=d[l+4&7])^u<<7,u=d[l+7&7],d[l]=p^=(u^=u<<13)^u<<9,o.i=l+1&7,p},function f(d,l){var u,v=[];if(l===(0|l))v[0]=l;else for(l=""+l,u=0;u<l.length;++u)v[7&u]=v[7&u]<<15^l.charCodeAt(u)+v[u+1&7]<<13;for(;v.length<8;)v.push(0);for(u=0;u<8&&0===v[u];++u);for(8==u&&(v[7]=-1),d.x=v,d.i=0,u=256;u>0;--u)d.next()}(o,g)}function L(g,o){return o.x=g.x.slice(),o.i=g.i,o}function S(g,o){null==g&&(g=+new Date);var f=new I(g),d=o&&o.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,d&&(d.x&&L(d,f),l.state=function(){return L(f,{})}),l}x&&x.exports?x.exports=S:m.amdD&&m.amdO?void 0!==(M=function(){return S}.call(A,m,A,x))&&(x.exports=M):this.xorshift7=S}(0,w=m.nmd(w))},657:function(w,A,m){var M;!function(U,x,H){function I(g){var o=this,f="";o.next=function(){var l=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,(o.d=o.d+362437|0)+(o.v=o.v^o.v<<4^l^l<<1)|0},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,g===(0|g)?o.x=g:f+=g;for(var d=0;d<f.length+64;d++)o.x^=0|f.charCodeAt(d),d==f.length&&(o.d=o.x<<10^o.x>>>4),o.next()}function L(g,o){return o.x=g.x,o.y=g.y,o.z=g.z,o.w=g.w,o.v=g.v,o.d=g.d,o}function S(g,o){var f=new I(g),d=o&&o.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,d&&("object"==typeof d&&L(d,f),l.state=function(){return L(f,{})}),l}x&&x.exports?x.exports=S:m.amdD&&m.amdO?void 0!==(M=function(){return S}.call(A,m,A,x))&&(x.exports=M):this.xorwow=S}(0,w=m.nmd(w))},818:function(w,A,m){var M;!function(U,x,H){var u,I=256,o=H.pow(I,6),f=H.pow(2,52),d=2*f,l=255;function p(E,O,B){var j=[],D=Y(G((O=1==O?{entropy:!0}:O||{}).entropy?[E,rt(x)]:null==E?function ot(){try{var E;return u&&(E=u.randomBytes)?E=E(I):(E=new Uint8Array(I),(U.crypto||U.msCrypto).getRandomValues(E)),rt(E)}catch(j){var O=U.navigator,B=O&&O.plugins;return[+new Date,U,B,U.screen,rt(x)]}}():E,3),j),_=new v(j),k=function(){for(var F=_.g(6),P=o,V=0;F<f;)F=(F+V)*I,P*=I,V=_.g(1);for(;F>=d;)F/=2,P/=2,V>>>=1;return(F+V)/P};return k.int32=function(){return 0|_.g(4)},k.quick=function(){return _.g(4)/4294967296},k.double=k,Y(rt(_.S),x),(O.pass||B||function(F,P,V,$){return $&&($.S&&W($,_),F.state=function(){return W(_,{})}),V?(H.random=F,P):F})(k,D,"global"in O?O.global:this==H,O.state)}function v(E){var O,B=E.length,j=this,D=0,_=j.i=j.j=0,k=j.S=[];for(B||(E=[B++]);D<I;)k[D]=D++;for(D=0;D<I;D++)k[D]=k[_=l&_+E[D%B]+(O=k[D])],k[_]=O;(j.g=function(F){for(var P,V=0,$=j.i,q=j.j,tt=j.S;F--;)P=tt[$=l&$+1],V=V*I+tt[l&(tt[$]=tt[q=l&q+P])+(tt[q]=P)];return j.i=$,j.j=q,V})(I)}function W(E,O){return O.i=E.i,O.j=E.j,O.S=E.S.slice(),O}function G(E,O){var D,B=[],j=typeof E;if(O&&"object"==j)for(D in E)try{B.push(G(E[D],O-1))}catch(_){}return B.length?B:"string"==j?E:E+"\0"}function Y(E,O){for(var j,B=E+"",D=0;D<B.length;)O[l&D]=l&(j^=19*O[l&D])+B.charCodeAt(D++);return rt(O)}function rt(E){return String.fromCharCode.apply(0,E)}if(Y(H.random(),x),w.exports){w.exports=p;try{u=m(42)}catch(E){}}else void 0!==(M=function(){return p}.call(A,m,A,w))&&(w.exports=M)}("undefined"!=typeof self?self:this,[],Math)},42:()=>{}},Ct={};function X(w){var A=Ct[w];if(void 0!==A)return A.exports;var m=Ct[w]={id:w,loaded:!1,exports:{}};return Tt[w].call(m.exports,m,m.exports,X),m.loaded=!0,m.exports}X.m=Tt,X.amdD=function(){throw new Error("define cannot be used indirect")},X.amdO={},X.u=w=>w+".755156d05501e688.js",X.o=(w,A)=>Object.prototype.hasOwnProperty.call(w,A),X.nmd=w=>(w.paths=[],w.children||(w.children=[]),w),X.tt=()=>(void 0===w&&(w={createScriptURL:A=>A},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(w=trustedTypes.createPolicy("angular#bundler",w))),w),X.tu=w=>X.tt().createScriptURL(w),X.p="",X.b=self.location+"",X(161)})();