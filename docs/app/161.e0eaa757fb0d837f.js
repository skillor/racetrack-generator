(()=>{var v,It={161:(v,O,p)=>{"use strict";function F(n){return this instanceof F?(this.v=n,this):new F(n)}function N(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=e.apply(n,t||[]),s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(A){r[A]&&(i[A]=function(R){return new Promise(function(K,Q){s.push([A,R,K,Q])>1||f(A,R)})})}function f(A,R){try{!function x(A){A.value instanceof F?Promise.resolve(A.value.v).then(y,S):z(s[0][2],A)}(r[A](R))}catch(K){z(s[0][3],K)}}function y(A){f("next",A)}function S(A){f("throw",A)}function z(A,R){A(R),s.shift(),s.length&&f(s[0][0],s[0][1])}}function nt(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function c(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(s){e[s]=n[s]&&function(a){return new Promise(function(f,x){!function i(s,a,f,x){Promise.resolve(x).then(function(y){s({value:y,done:f})},a)}(f,x,(a=n[s](a)).done,a.value)})}}}const G=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function w(n){return"function"==typeof n}function Y(n){return w(null==n?void 0:n.then)}const Z=function $(n){const e=n(r=>{Error.call(r),r.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function q(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class tt{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:r}=this;if(w(r))try{r()}catch(s){t=s instanceof Z?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{Lt(s)}catch(a){t=null!=t?t:[],a instanceof Z?t=[...t,...a.errors]:t.push(a)}}if(t)throw new Z(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Lt(t);else{if(t instanceof tt){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&q(e,t)}remove(t){const{_finalizers:e}=this;e&&q(e,t),t instanceof tt&&t._removeParent(this)}}function jt(n){return n instanceof tt||n&&"closed"in n&&w(n.remove)&&w(n.add)&&w(n.unsubscribe)}function Lt(n){w(n)?n():n.unsubscribe()}tt.EMPTY=(()=>{const n=new tt;return n.closed=!0,n})();const rt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},yt={setTimeout(n,t,...e){const{delegate:r}=yt;return(null==r?void 0:r.setTimeout)?r.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=yt;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function zt(n){yt.setTimeout(()=>{const{onUnhandledError:t}=rt;if(!t)throw n;t(n)})}function Rt(){}const Zt=vt("C",void 0,void 0);function vt(n,t,e){return{kind:n,value:t,error:e}}let it=null;class xt extends tt{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,jt(t)&&t.add(this)):this.destination=oe}static create(t,e,r){return new wt(t,e,r)}next(t){this.isStopped?Pt(function te(n){return vt("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Pt(function qt(n){return vt("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Pt(Zt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const re=Function.prototype.bind;function bt(n,t){return re.call(n,t)}class ie{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(r){gt(r)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(r){gt(r)}else gt(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){gt(e)}}}class wt extends xt{constructor(t,e,r){let i;if(super(),w(t)||!t)i={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=r?r:void 0};else{let s;this&&rt.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),i={next:t.next&&bt(t.next,s),error:t.error&&bt(t.error,s),complete:t.complete&&bt(t.complete,s)}):i=t}this.destination=new ie(i)}}function gt(n){rt.useDeprecatedSynchronousErrorHandling?function ne(n){rt.useDeprecatedSynchronousErrorHandling&&it&&(it.errorThrown=!0,it.error=n)}(n):zt(n)}function Pt(n,t){const{onStoppedNotification:e}=rt;e&&yt.setTimeout(()=>e(n,t))}const oe={closed:!0,next:Rt,error:function se(n){throw n},complete:Rt},St="function"==typeof Symbol&&Symbol.observable||"@@observable";function ae(n){return n}let J=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const r=new n;return r.source=this,r.operator=e,r}subscribe(e,r,i){const s=function le(n){return n&&n instanceof xt||function ce(n){return n&&w(n.next)&&w(n.error)&&w(n.complete)}(n)&&jt(n)}(e)?e:new wt(e,r,i);return function ee(n){if(rt.useDeprecatedSynchronousErrorHandling){const t=!it;if(t&&(it={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:r}=it;if(it=null,e)throw r}}else n()}(()=>{const{operator:a,source:f}=this;s.add(a?a.call(s,f):f?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return new(r=Gt(r))((i,s)=>{const a=new wt({next:f=>{try{e(f)}catch(x){s(x),a.unsubscribe()}},error:s,complete:i});this.subscribe(a)})}_subscribe(e){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(e)}[St](){return this}pipe(...e){return function Ft(n){return 0===n.length?ae:1===n.length?n[0]:function(e){return n.reduce((r,i)=>i(r),e)}}(e)(this)}toPromise(e){return new(e=Gt(e))((r,i)=>{let s;this.subscribe(a=>s=a,a=>i(a),()=>r(s))})}}return n.create=t=>new n(t),n})();function Gt(n){var t;return null!==(t=null!=n?n:rt.Promise)&&void 0!==t?t:Promise}function Bt(n){return w(n[St])}function Ut(n){return Symbol.asyncIterator&&w(null==n?void 0:n[Symbol.asyncIterator])}function _t(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ht=function ue(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Xt(n){return w(null==n?void 0:n[Ht])}function Wt(n){return N(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:r,done:i}=yield F(e.read());if(i)return yield F(void 0);yield yield F(r)}}finally{e.releaseLock()}})}function Yt(n){return w(null==n?void 0:n.getReader)}function at(n){if(n instanceof J)return n;if(null!=n){if(Bt(n))return function fe(n){return new J(t=>{const e=n[St]();if(w(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(G(n))return function he(n){return new J(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(Y(n))return function de(n){return new J(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,zt)})}(n);if(Ut(n))return Nt(n);if(Xt(n))return function ye(n){return new J(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(Yt(n))return function ge(n){return Nt(Wt(n))}(n)}throw _t(n)}function Nt(n){return new J(t=>{(function pe(n,t){var e,r,i,s;return function d(n,t,e,r){return new(e||(e=Promise))(function(s,a){function f(S){try{y(r.next(S))}catch(z){a(z)}}function x(S){try{y(r.throw(S))}catch(z){a(z)}}function y(S){S.done?s(S.value):function i(s){return s instanceof e?s:new e(function(a){a(s)})}(S.value).then(f,x)}y((r=r.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=nt(n);!(r=yield e.next()).done;)if(t.next(r.value),t.closed)return}catch(a){i={error:a}}finally{try{r&&!r.done&&(s=e.return)&&(yield s.call(e))}finally{if(i)throw i.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function ut(n){return t=>{if(function me(n){return w(null==n?void 0:n.lift)}(t))return t.lift(function(e){try{return n(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ft(n,t,e,r,i){return new ve(n,t,e,r,i)}class ve extends xt{constructor(t,e,r,i,s,a){super(t),this.onFinalize=s,this.shouldUnsubscribe=a,this._next=e?function(f){try{e(f)}catch(x){t.error(x)}}:super._next,this._error=i?function(f){try{i(f)}catch(x){t.error(x)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(f){t.error(f)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function pt(n,t){return ut((e,r)=>{let i=0;e.subscribe(ft(r,s=>{r.next(n.call(t,s,i++))}))})}function et(n,t,e,r=0,i=!1){const s=t.schedule(function(){e(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function Vt(n,t,e=1/0){return w(t)?Vt((r,i)=>pt((s,a)=>t(r,s,i,a))(at(n(r,i))),e):("number"==typeof t&&(e=t),ut((r,i)=>function xe(n,t,e,r,i,s,a,f){const x=[];let y=0,S=0,z=!1;const A=()=>{z&&!x.length&&!y&&t.complete()},R=Q=>y<r?K(Q):x.push(Q),K=Q=>{s&&t.next(Q),y++;let ct=!1;at(e(Q,S++)).subscribe(ft(t,k=>{null==i||i(k),s?R(k):t.next(k)},()=>{ct=!0},void 0,()=>{if(ct)try{for(y--;x.length&&y<r;){const k=x.shift();a?et(t,a,()=>K(k)):K(k)}A()}catch(k){t.error(k)}}))};return n.subscribe(ft(t,R,()=>{z=!0,A()})),()=>{null==f||f()}}(r,i,n,e)))}const{isArray:be}=Array;const Se=["addListener","removeListener"],Ee=["addEventListener","removeEventListener"],Me=["on","off"];function Et(n,t,e,r){if(w(e)&&(r=e,e=void 0),r)return Et(n,t,e).pipe(function Pe(n){return pt(t=>function we(n,t){return be(t)?n(...t):n(t)}(n,t))}(r));const[i,s]=function Te(n){return w(n.addEventListener)&&w(n.removeEventListener)}(n)?Ee.map(a=>f=>n[a](t,f,e)):function Ae(n){return w(n.addListener)&&w(n.removeListener)}(n)?Se.map(Jt(n,t)):function Oe(n){return w(n.on)&&w(n.off)}(n)?Me.map(Jt(n,t)):[];if(!i&&G(n))return Vt(a=>Et(a,t,e))(at(n));if(!i)throw new TypeError("Invalid event target");return new J(a=>{const f=(...x)=>a.next(1<x.length?x:x[0]);return i(f),()=>s(f)})}function Jt(n,t){return e=>r=>n[e](t,r)}const Kt=new J(n=>n.complete());function kt(n,t=0){return ut((e,r)=>{e.subscribe(ft(r,i=>et(r,n,()=>r.next(i),t),()=>et(r,n,()=>r.complete(),t),i=>et(r,n,()=>r.error(i),t)))})}function $t(n,t=0){return ut((e,r)=>{r.add(n.schedule(()=>e.subscribe(r),t))})}function Qt(n,t){if(!n)throw new Error("Iterable cannot be null");return new J(e=>{et(e,t,()=>{const r=n[Symbol.asyncIterator]();et(e,t,()=>{r.next().then(i=>{i.done?e.complete():e.next(i.value)})},0,!0)})})}function _e(...n){return function Ue(n,t){return t?function Be(n,t){if(null!=n){if(Bt(n))return function Le(n,t){return at(n).pipe($t(t),kt(t))}(n,t);if(G(n))return function Re(n,t){return new J(e=>{let r=0;return t.schedule(function(){r===n.length?e.complete():(e.next(n[r++]),e.closed||this.schedule())})})}(n,t);if(Y(n))return function ze(n,t){return at(n).pipe($t(t),kt(t))}(n,t);if(Ut(n))return Qt(n,t);if(Xt(n))return function Fe(n,t){return new J(e=>{let r;return et(e,t,()=>{r=n[Ht](),et(e,t,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(a){return void e.error(a)}s?e.complete():e.next(i)},0,!0)}),()=>w(null==r?void 0:r.return)&&r.return()})}(n,t);if(Yt(n))return function Ge(n,t){return Qt(Wt(n),t)}(n,t)}throw _t(n)}(n,t):at(n)}(n,function je(n){return function De(n){return n&&w(n.schedule)}(function Mt(n){return n[n.length-1]}(n))?n.pop():void 0}(n))}var He=p(340);class ht{constructor(t={}){this.minSegments=50,this.maxSegments=1e5,this.xComputeFactor=.5,this.yComputeFactor=.5,this.angleComputeFactor=9,this.maxTrys=20,this.maxCurve=45,this.gateDistance=10,this.curveComputeCount=4,this.maxIterations=1e6,this.minGateHalfSize=5,this.maxGateHalfSize=15,this.maxCollisions=0,this.distanceMatch=19,this.angleMatch=.3;for(const e of this.getPropertyNames())this.setProperty(e,t[e])}getType(t){return typeof t}setProperty(t,e){this.getType(this.getProperty(t))===this.getType(e)&&(this[t]=e)}getProperty(t){return this[t]}getPropertyNames(){return Object.getOwnPropertyNames(this)}validate(){this.minSegments=Math.min(this.minSegments,this.maxSegments)}copy(){return ht.unserialize(this.serialize())}serialize(){return JSON.stringify(Object.assign({},this))}static unserialize(t){return new ht(JSON.parse(t))}}class st{constructor(t,e,r,i=null,s=null,a,f=[]){this.debugCanvasContext=null,this.trackCanvasContext=null,this.width=t,this.height=e,this.collisions=r,null!==s&&(this.trackCanvasContext=s.getContext("2d")),null!==i&&(this.debugCanvasContext=i.getContext("2d")),this.gates=a,this.deletedBarriers=f}static drawPoint(t,e,r="#fff"){null!==t&&(t.fillStyle=r,t.fillRect(e[0]-1,e[1]-1,2,2))}static drawGate(t,e,r="#f00",i="#0f0"){null!==t&&(this.drawPoint(t,e[0],r),this.drawPoint(t,e[1],i))}static drawLine(t,e,r="#f00"){null!==t&&(t.strokeStyle=r,t.beginPath(),t.moveTo(e[0][0],e[0][1]),t.lineTo(e[1][0],e[1][1]),t.closePath(),t.stroke())}static drawPolygon(t,e,r="#fff",i=null){if(null!==t&&0!=e.length){null!==r&&(t.fillStyle=r),null!==i&&(t.strokeStyle=i),t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(let s=1;s<e.length;s++)t.lineTo(e[s][0],e[s][1]);t.lineTo(e[0][0],e[0][1]),t.closePath(),null!==r&&t.fill(),null!==i&&t.stroke()}}serialize(){return JSON.stringify({width:this.width,height:this.height,collisions:this.collisions,gates:this.gates,deletedBarriers:this.deletedBarriers})}static unserialize(t){const e=JSON.parse(t);return new st(e.width,e.height,e.collisions,null,null,e.gates,e.deletedBarriers)}getBarrierLines(t=0,e=-1){e<0&&(e=this.gates.length);const r=[];for(let i=e-1;i>t+1;i--)for(let s of[0,1])this.deletedBarriers.includes(2*(i-1)+s)||r.push([this.gates[i][s],this.gates[i-1][s]]);return r}firstGate(){return this.gates[0]}lastGate(){return this.gates[this.gates.length-1]}deleteLastGates(t){this.gates.splice(this.gates.length-t,t)}drawTrack(t=0,e=-1){if(null!==this.trackCanvasContext){this.trackCanvasContext.clearRect(0,0,this.width,this.height),e<0&&(e=this.gates.length);for(let r of this.getBarrierLines(t,e))st.drawLine(this.trackCanvasContext,r,"#fff");for(let r=t;r<e;r++)st.drawGate(this.trackCanvasContext,this.gates[r])}}}class L{constructor(t,e,r,i="random",s="",a=new ht){this.track=t,this.startGate=e,this.endGate=r,this.mode=i,this.settings=a,""===s&&(s=(""+Math.random()).substring(2)),this.seed=s,this.random=He(s)}static pointEquals(t,e){return t[0]==e[0]&&t[1]==e[1]}static lineEqualsStrict(t,e){return this.pointEquals([t[0][0],t[0][1]],[e[0][0],e[0][1]])&&this.pointEquals([t[1][0],t[1][1]],[e[1][0],e[1][1]])}gateCenterPos(t){return[t[0][0]+.5*(t[1][0]-t[0][0]),t[0][1]+.5*(t[1][1]-t[0][1])]}degreesToRadians(t){return t*(Math.PI/180)}static normalizeAngle(t){return t-this.TWO_PI*Math.floor((t+Math.PI)/this.TWO_PI)}static normalizeAngle10(t){return(t+Math.PI)/this.TWO_PI}static vectorAngle(t){return Math.atan2(t[1],t[0])}static angleToVector(t){return[Math.cos(t),Math.sin(t)]}angleToVectorMultiplied(t,e){return[Math.cos(t)*e,Math.sin(t)*e]}static lineAngle(t){return this.vectorAngle([t[1][0]-t[0][0],t[1][1]-t[0][1]])}static gateAngle(t){return this.normalizeAngle(this.lineAngle(t)-.5*Math.PI)}static rotatePoint(t,e){const r=Math.cos(e),i=Math.sin(e);return[r*t[0]-i*t[1],i*t[0]+r*t[1]]}static addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}static rotatedRect(t,e,r){return[this.addPoints(t,this.rotatePoint(e,r)),this.addPoints(t,this.rotatePoint([e[0],-e[1]],r)),this.addPoints(t,this.rotatePoint([-e[0],-e[1]],r)),this.addPoints(t,this.rotatePoint([-e[0],e[1]],r))]}static lineLengthUnnormed(t){const e=t[0][0]-t[1][0],r=t[0][1]-t[1][1];return e*e+r*r}static lineLength(t){return Math.sqrt(this.lineLengthUnnormed(t))}static pointToGate(t,e,r,i=!1){return[this.pointTravel(t,e-.5*Math.PI,r,i),this.pointTravel(t,e+.5*Math.PI,r,i)]}static pointTravel(t,e,r,i=!1){const s=[t[0]+Math.cos(e)*r,t[1]+Math.sin(e)*r];return i&&(s[0]=Math.round(s[0]),s[1]=Math.round(s[1])),s}boundsLines(){return[[[0,0],[this.track.width,0]],[[0,0],[0,this.track.height]],[[this.track.width,this.track.height],[this.track.width,0]],[[this.track.width,this.track.height],[0,this.track.height]]]}pointOutBounds(t){return t[0]<0||t[1]<0||t[0]>this.track.width||t[1]>this.track.height}static centerOfLine(t){return[.5*(t[0][0]+t[1][0]),.5*(t[0][1]+t[1][1])]}lineOutBounds(t){return this.pointOutBounds(t[0])||this.pointOutBounds(t[1])}lineIntersectionPoint(t,e){let z,A,R,r=t[0][0],i=t[0][1],s=t[1][0],a=t[1][1],f=e[0][0],x=e[0][1],y=e[1][0],S=e[1][1];return z=(s-r)*(S-x)-(y-f)*(a-i),0!==z&&(R=((S-x)*(y-r)+(f-y)*(S-i))/z,A=((i-a)*(y-r)+(s-r)*(S-i))/z,0<R&&R<1&&0<A&&A<1)?[r+R*(s-r),i+R*(a-i)]:null}gateHasCollision(t,e,r){const i=[[t[0],e[0]],[e[0],e[1]],[e[1],t[1]]];if(this.hasPolyPixelCollision([t[0],e[0],e[1],t[1]]))return!0;for(let s of i){const a=this.track.gates.concat(r);for(let f=a.length-1;f>1;f--)for(let x of[0,1])if(null!==this.lineIntersectionPoint([s[0],s[1]],[a[f][x],a[f-1][x]]))return!0}return!1}getLineBounds(t){return[Math.min(t[0][1],t[1][1]),Math.min(t[0][0],t[1][0]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]}getLinesBounds(t){let e=1/0,r=1/0,i=-1/0,s=-1/0;for(const a of t)e=Math.min(e,a[0][1],a[1][1]),r=Math.min(r,a[0][0],a[1][0]),i=Math.max(i,a[0][0],a[1][0]),s=Math.max(s,a[0][1],a[1][1]);return[e,r,i,s]}hasRectangleCollision(t,e){return t[1]<e[2]&&t[2]>e[1]&&t[0]<e[3]&&t[3]>e[0]}lineIsValidY(t,e){return t>=e[0][1]&&t<e[1][1]||t>=e[1][1]&&t<e[0][1]}lineGetM(t){return(t[1][1]-t[0][1])/(t[1][0]-t[0][0])}lineGetX(t,e){return 1/this.lineGetM(e)*(t-e[0][1])+e[0][0]}getLinesMeetY(t,e){let r=[];for(let i=0;i<e.length;i++){const s=e[i];this.lineIsValidY(t,s)&&r.push(this.lineGetX(t,s))}for(let i=0;i<r.length;i++)for(let s=i;s<r.length;s++)if(r[i]>r[s]){let a=r[i];r[i]=r[s],r[s]=a}return r}hasPolyPixelCollision(t){const e=[];for(let a=1;a<t.length;a++)e.push([t[a-1],t[a]]);e.push([t[t.length-1],t[0]]);const r=this.getLinesBounds(e),i=Math.floor(r[0]),s=Math.ceil(r[3]);st.drawPolygon(this.track.debugCanvasContext,t,null,"#f00");for(let a=i;a<s;a++){const f=this.getLinesMeetY(a,e);for(let x=1;x<f.length;x+=2){const y=Math.ceil(f[x]);for(let S=Math.floor(f[x-1]);S<y;S++)if(this.track.collisions[a][S])return!0}}return!1}hasPolyPolyCollision(t,e){const r=this.getLinesBounds(t),i=this.getLinesBounds(e);return this.hasRectangleCollision(r,i)}serialize(){return JSON.stringify({track:this.track.serialize(),start:this.startGate,end:this.endGate,mode:this.mode,seed:this.seed,settings:this.settings.serialize()})}static unserialize(t){const e=JSON.parse(t);return new L(st.unserialize(e.track),e.start,e.end,e.mode,e.seed,ht.unserialize(e.settings))}calcMaxGateHalfSize(t,e){let s,r=L.pointToGate(t,e,this.track.width*this.track.height),i=+this.settings.maxGateHalfSize;const a=this.track.gates.concat(this.boundsLines());for(let f=a.length-1;f>1;f--)for(let x of[0,1])if(s=this.lineIntersectionPoint([r[0],r[1]],[a[f][x],a[f-1][x]]),null!==s){const y=L.lineLength([s,t]);(y<0||y<i)&&(i=y)}return i}predictDirections(t,e,r){const i=L.lineAngle([t,e]),s=[L.normalizeAngle(r)];for(let f=+this.settings.curveComputeCount-1;f>0;f--){const x=f*this.degreesToRadians(+this.settings.maxCurve)/+this.settings.curveComputeCount;s.push(L.normalizeAngle(r+x)),s.push(L.normalizeAngle(r-x))}s.sort((f,x)=>Math.abs(L.normalizeAngle(i-x))-Math.abs(L.normalizeAngle(i-f)));const a=[];for(const f of s)a.push(this.angleToVectorMultiplied(f,+this.settings.gateDistance));return a}randomShuffle(t){return t.sort(()=>.5-this.random())}pointAngleMatches(t,e,r,i){return!(L.lineLengthUnnormed([t,r])>+this.settings.distanceMatch||Math.abs(L.normalizeAngle(e-i))>+this.settings.angleMatch)}posAngleToGrid(t,e){return[Math.floor(t[1]*+this.settings.yComputeFactor),Math.floor(t[0]*+this.settings.xComputeFactor),Math.floor(L.normalizeAngle10(e)*+this.settings.angleComputeFactor)]}isValidGridPos(t,e){return t[0]>=0&&t[0]<e[0]&&t[1]>=0&&t[1]<e[1]&&t[2]>=0&&t[2]<e[2]}findTrackDFS(t=0,e=0){this.settings.validate();const r=[],i=this.gateCenterPos(this.endGate),s=L.gateAngle(this.endGate),a=this.posAngleToGrid([this.track.width,this.track.height],Math.PI);console.log(a);const f=new Array(a[0]);for(let x=0;x<a[0];x++){f[x]=new Array(a[1]);for(let y=0;y<a[1];y++){f[x][y]=new Array(a[2]);for(let S=0;S<a[2];S++)f[x][y][S]=!1}}for(r.push([this.startGate,[],0]);;){let x=r.pop();if(void 0===x)return e>=+this.settings.maxTrys-1?[[],!1,t]:(this.settings.angleComputeFactor+=1,this.findTrackDFS(t,e+1));const y=x[0],S=x[1];let z=x[2];const A=this.gateCenterPos(y),R=L.gateAngle(y),K=this.posAngleToGrid(A,R);f[K[0]][K[1]][K[2]]=!0,st.drawPoint(this.track.debugCanvasContext,A,"#fff");const Q=this.pointAngleMatches(A,R,i,s),ct=S.length,k=Q&&ct>=+this.settings.minSegments;if(k||ct>=+this.settings.maxSegments)return k&&S.push(this.endGate),console.log(ct+" segments"),console.log(z+" collisions"),[S,Q,t];let dt=this.predictDirections(A,i,R);switch(this.mode){case"longest":dt=dt.reverse();break;case"random":dt=this.randomShuffle(dt)}for(let At of dt){const Ot=[Math.floor(A[0]+At[0]),Math.floor(A[1]+At[1])],Tt=L.vectorAngle(At);let lt=Math.min(+this.settings.maxGateHalfSize,this.calcMaxGateHalfSize(Ot,Tt));lt>+this.settings.minGateHalfSize&&(lt=+this.settings.minGateHalfSize+this.random()*(lt-+this.settings.minGateHalfSize)),lt=Math.max(+this.settings.minGateHalfSize,lt);const Ct=L.pointToGate(Ot,Tt,lt),mt=this.posAngleToGrid(Ot,Tt);this.isValidGridPos(mt,a)&&!f[mt[0]][mt[1]][mt[2]]&&!this.lineOutBounds(Ct)&&(this.gateHasCollision(y,Ct,S)&&(z+=1),z<=+this.settings.maxCollisions&&r.push([Ct,S.concat([y]),z]))}if(++t>+this.settings.maxIterations)return[[],!1,t]}}findTrackDFSWorker(t=!0){if(t&&"undefined"!=typeof Worker){const e=new Worker(p.tu(new URL(p.p+p.u(161),p.b))),r=Et(e,"message").pipe(function Ie(n){return n<=0?()=>Kt:ut((t,e)=>{let r=0;t.subscribe(ft(e,i=>{++r<=n&&(e.next(i),n<=r&&e.complete())}))})}(1),pt(i=>(console.log(i.data),i.data)));return e.postMessage({type:"start",trackGenerator:this.serialize()}),r}return _e(this.findTrackDFS())}generate(t=!0){const e=(new Date).getTime();return this.findTrackDFSWorker(t).pipe(pt(r=>{const i=(new Date).getTime()-e;if(0==r[0].length)return console.log("path was not found!"),[i,r[2]];const s=r[0];r[1]&&console.log("path is finished");const a=s.length;for(let f=0;f<a;f++)f>0&&this.track.gates.push(s[f]);return[i,r[2]]}))}}L.TWO_PI=2*Math.PI,addEventListener("message",({data:n})=>{const t=L.unserialize(n.trackGenerator);postMessage(t.findTrackDFS())})},340:(v,O,p)=>{var E=p(471),U=p(992),b=p(657),_=p(583),C=p(929),I=p(83),P=p(818);P.alea=E,P.xor128=U,P.xorwow=b,P.xorshift7=_,P.xor4096=C,P.tychei=I,v.exports=P},471:function(v,O,p){var E;!function(U,b,_){function C(o){var u=this,h=function d(){var o=4022871197;return function(h){h=String(h);for(var c=0;c<h.length;c++){var l=.02519603282416938*(o+=h.charCodeAt(c));l-=o=l>>>0,o=(l*=o)>>>0,o+=4294967296*(l-=o)}return 2.3283064365386963e-10*(o>>>0)}}();u.next=function(){var c=2091639*u.s0+2.3283064365386963e-10*u.c;return u.s0=u.s1,u.s1=u.s2,u.s2=c-(u.c=0|c)},u.c=1,u.s0=h(" "),u.s1=h(" "),u.s2=h(" "),u.s0-=h(o),u.s0<0&&(u.s0+=1),u.s1-=h(o),u.s1<0&&(u.s1+=1),u.s2-=h(o),u.s2<0&&(u.s2+=1),h=null}function I(o,u){return u.c=o.c,u.s0=o.s0,u.s1=o.s1,u.s2=o.s2,u}function P(o,u){var h=new C(o),c=u&&u.state,l=h.next;return l.int32=function(){return 4294967296*h.next()|0},l.double=function(){return l()+11102230246251565e-32*(2097152*l()|0)},l.quick=l,c&&("object"==typeof c&&I(c,h),l.state=function(){return I(h,{})}),l}b&&b.exports?b.exports=P:p.amdD&&p.amdO?void 0!==(E=function(){return P}.call(O,p,O,b))&&(b.exports=E):this.alea=P}(0,v=p.nmd(v))},83:function(v,O,p){var E;!function(U,b,_){function C(d){var o=this,u="";o.next=function(){var c=o.b,l=o.c,g=o.d,m=o.a;return c=c<<25^c>>>7^l,l=l-g|0,g=g<<24^g>>>8^m,m=m-c|0,o.b=c=c<<20^c>>>12^l,o.c=l=l-g|0,o.d=g<<16^l>>>16^m,o.a=m-c|0},o.a=0,o.b=0,o.c=-1640531527,o.d=1367130551,d===Math.floor(d)?(o.a=d/4294967296|0,o.b=0|d):u+=d;for(var h=0;h<u.length+20;h++)o.b^=0|u.charCodeAt(h),o.next()}function I(d,o){return o.a=d.a,o.b=d.b,o.c=d.c,o.d=d.d,o}function P(d,o){var u=new C(d),h=o&&o.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&("object"==typeof h&&I(h,u),c.state=function(){return I(u,{})}),c}b&&b.exports?b.exports=P:p.amdD&&p.amdO?void 0!==(E=function(){return P}.call(O,p,O,b))&&(b.exports=E):this.tychei=P}(0,v=p.nmd(v))},992:function(v,O,p){var E;!function(U,b,_){function C(d){var o=this,u="";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var c=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^c^c>>>8},d===(0|d)?o.x=d:u+=d;for(var h=0;h<u.length+64;h++)o.x^=0|u.charCodeAt(h),o.next()}function I(d,o){return o.x=d.x,o.y=d.y,o.z=d.z,o.w=d.w,o}function P(d,o){var u=new C(d),h=o&&o.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&("object"==typeof h&&I(h,u),c.state=function(){return I(u,{})}),c}b&&b.exports?b.exports=P:p.amdD&&p.amdO?void 0!==(E=function(){return P}.call(O,p,O,b))&&(b.exports=E):this.xor128=P}(0,v=p.nmd(v))},929:function(v,O,p){var E;!function(U,b,_){function C(d){var o=this;o.next=function(){var g,m,h=o.w,c=o.X,l=o.i;return o.w=h=h+1640531527|0,m=c[l+34&127],g=c[l=l+1&127],m^=m<<13,g^=g<<17,m=c[l]=(m^=m>>>15)^(g^=g>>>12),o.i=l,m+(h^h>>>16)|0},function u(h,c){var l,g,m,H,F,N=[],ot=128;for(c===(0|c)?(g=c,c=null):(c+="\0",g=0,ot=Math.max(ot,c.length)),m=0,H=-32;H<ot;++H)c&&(g^=c.charCodeAt((H+32)%c.length)),0===H&&(F=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,H>=0&&(m=0==(l=N[127&H]^=g+(F=F+1640531527|0))?m+1:0);for(m>=128&&(N[127&(c&&c.length||0)]=-1),m=127,H=512;H>0;--H)g=N[m+34&127],l=N[m=m+1&127],g^=g<<13,l^=l<<17,N[m]=(g^=g>>>15)^(l^=l>>>12);h.w=F,h.X=N,h.i=m}(o,d)}function I(d,o){return o.i=d.i,o.w=d.w,o.X=d.X.slice(),o}function P(d,o){null==d&&(d=+new Date);var u=new C(d),h=o&&o.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&(h.X&&I(h,u),c.state=function(){return I(u,{})}),c}b&&b.exports?b.exports=P:p.amdD&&p.amdO?void 0!==(E=function(){return P}.call(O,p,O,b))&&(b.exports=E):this.xor4096=P}(0,v=p.nmd(v))},583:function(v,O,p){var E;!function(U,b,_){function C(d){var o=this;o.next=function(){var l,g,h=o.x,c=o.i;return l=h[c],g=(l^=l>>>7)^l<<24,g^=(l=h[c+1&7])^l>>>10,g^=(l=h[c+3&7])^l>>>3,g^=(l=h[c+4&7])^l<<7,l=h[c+7&7],h[c]=g^=(l^=l<<13)^l<<9,o.i=c+1&7,g},function u(h,c){var l,m=[];if(c===(0|c))m[0]=c;else for(c=""+c,l=0;l<c.length;++l)m[7&l]=m[7&l]<<15^c.charCodeAt(l)+m[l+1&7]<<13;for(;m.length<8;)m.push(0);for(l=0;l<8&&0===m[l];++l);for(8==l&&(m[7]=-1),h.x=m,h.i=0,l=256;l>0;--l)h.next()}(o,d)}function I(d,o){return o.x=d.x.slice(),o.i=d.i,o}function P(d,o){null==d&&(d=+new Date);var u=new C(d),h=o&&o.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&(h.x&&I(h,u),c.state=function(){return I(u,{})}),c}b&&b.exports?b.exports=P:p.amdD&&p.amdO?void 0!==(E=function(){return P}.call(O,p,O,b))&&(b.exports=E):this.xorshift7=P}(0,v=p.nmd(v))},657:function(v,O,p){var E;!function(U,b,_){function C(d){var o=this,u="";o.next=function(){var c=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,(o.d=o.d+362437|0)+(o.v=o.v^o.v<<4^c^c<<1)|0},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,d===(0|d)?o.x=d:u+=d;for(var h=0;h<u.length+64;h++)o.x^=0|u.charCodeAt(h),h==u.length&&(o.d=o.x<<10^o.x>>>4),o.next()}function I(d,o){return o.x=d.x,o.y=d.y,o.z=d.z,o.w=d.w,o.v=d.v,o.d=d.d,o}function P(d,o){var u=new C(d),h=o&&o.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do{var m=((u.next()>>>11)+(u.next()>>>0)/4294967296)/(1<<21)}while(0===m);return m},c.int32=u.next,c.quick=c,h&&("object"==typeof h&&I(h,u),c.state=function(){return I(u,{})}),c}b&&b.exports?b.exports=P:p.amdD&&p.amdO?void 0!==(E=function(){return P}.call(O,p,O,b))&&(b.exports=E):this.xorwow=P}(0,v=p.nmd(v))},818:function(v,O,p){var E;!function(U,b,_){var l,C=256,o=_.pow(C,6),u=_.pow(2,52),h=2*u,c=255;function g(M,T,B){var j=[],D=N(F((T=1==T?{entropy:!0}:T||{}).entropy?[M,nt(b)]:null==M?function ot(){try{var M;return l&&(M=l.randomBytes)?M=M(C):(M=new Uint8Array(C),(U.crypto||U.msCrypto).getRandomValues(M)),nt(M)}catch(j){var T=U.navigator,B=T&&T.plugins;return[+new Date,U,B,U.screen,nt(b)]}}():M,3),j),W=new m(j),V=function(){for(var G=W.g(6),w=o,Y=0;G<u;)G=(G+Y)*C,w*=C,Y=W.g(1);for(;G>=h;)G/=2,w/=2,Y>>>=1;return(G+Y)/w};return V.int32=function(){return 0|W.g(4)},V.quick=function(){return W.g(4)/4294967296},V.double=V,N(nt(W.S),b),(T.pass||B||function(G,w,Y,$){return $&&($.S&&H($,W),G.state=function(){return H(W,{})}),Y?(_.random=G,w):G})(V,D,"global"in T?T.global:this==_,T.state)}function m(M){var T,B=M.length,j=this,D=0,W=j.i=j.j=0,V=j.S=[];for(B||(M=[B++]);D<C;)V[D]=D++;for(D=0;D<C;D++)V[D]=V[W=c&W+M[D%B]+(T=V[D])],V[W]=T;(j.g=function(G){for(var w,Y=0,$=j.i,Z=j.j,q=j.S;G--;)w=q[$=c&$+1],Y=Y*C+q[c&(q[$]=q[Z=c&Z+w])+(q[Z]=w)];return j.i=$,j.j=Z,Y})(C)}function H(M,T){return T.i=M.i,T.j=M.j,T.S=M.S.slice(),T}function F(M,T){var D,B=[],j=typeof M;if(T&&"object"==j)for(D in M)try{B.push(F(M[D],T-1))}catch(W){}return B.length?B:"string"==j?M:M+"\0"}function N(M,T){for(var j,B=M+"",D=0;D<B.length;)T[c&D]=c&(j^=19*T[c&D])+B.charCodeAt(D++);return nt(T)}function nt(M){return String.fromCharCode.apply(0,M)}if(N(_.random(),b),v.exports){v.exports=g;try{l=p(42)}catch(M){}}else void 0!==(E=function(){return g}.call(O,p,O,v))&&(v.exports=E)}("undefined"!=typeof self?self:this,[],Math)},42:()=>{}},Dt={};function X(v){var O=Dt[v];if(void 0!==O)return O.exports;var p=Dt[v]={id:v,loaded:!1,exports:{}};return It[v].call(p.exports,p,p.exports,X),p.loaded=!0,p.exports}X.m=It,X.amdD=function(){throw new Error("define cannot be used indirect")},X.amdO={},X.u=v=>v+".e0eaa757fb0d837f.js",X.o=(v,O)=>Object.prototype.hasOwnProperty.call(v,O),X.nmd=v=>(v.paths=[],v.children||(v.children=[]),v),X.tt=()=>(void 0===v&&(v={createScriptURL:O=>O},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(v=trustedTypes.createPolicy("angular#bundler",v))),v),X.tu=v=>X.tt().createScriptURL(v),X.p="",X.b=self.location+"",X(161)})();