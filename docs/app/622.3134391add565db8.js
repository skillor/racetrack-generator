(()=>{var w,Lt={622:(w,O,m)=>{"use strict";function _(n){return this instanceof _?(this.v=n,this):new _(n)}function V(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=e.apply(n,t||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(T){r[T]&&(i[T]=function(G){return new Promise(function(Q,J){s.push([T,G,Q,J])>1||c(T,G)})})}function c(T,G){try{!function d(T){T.value instanceof _?Promise.resolve(T.value.v).then(h,x):D(s[0][2],T)}(r[T](G))}catch(Q){D(s[0][3],Q)}}function h(T){c("next",T)}function x(T){c("throw",T)}function D(T,G){T(G),s.shift(),s.length&&c(s[0][0],s[0][1])}}function nt(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function l(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(s){e[s]=n[s]&&function(o){return new Promise(function(c,d){!function i(s,o,c,d){Promise.resolve(d).then(function(h){s({value:h,done:c})},o)}(c,d,(o=n[s](o)).done,o.value)})}}}const R=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function S(n){return"function"==typeof n}function W(n){return S(null==n?void 0:n.then)}const Z=function K(n){const e=n(r=>{Error.call(r),r.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function q(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class tt{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const s of e)s.remove(this);else e.remove(this);const{initialTeardown:r}=this;if(S(r))try{r()}catch(s){t=s instanceof Z?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{Gt(s)}catch(o){t=null!=t?t:[],o instanceof Z?t=[...t,...o.errors]:t.push(o)}}if(t)throw new Z(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Gt(t);else{if(t instanceof tt){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&q(e,t)}remove(t){const{_finalizers:e}=this;e&&q(e,t),t instanceof tt&&t._removeParent(this)}}function Ct(n){return n instanceof tt||n&&"closed"in n&&S(n.remove)&&S(n.add)&&S(n.unsubscribe)}function Gt(n){S(n)?n():n.unsubscribe()}tt.EMPTY=(()=>{const n=new tt;return n.closed=!0,n})();const rt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ht={setTimeout(n,t,...e){const{delegate:r}=ht;return(null==r?void 0:r.setTimeout)?r.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=ht;return((null==t?void 0:t.clearTimeout)||clearTimeout)(n)},delegate:void 0};function jt(n){ht.setTimeout(()=>{const{onUnhandledError:t}=rt;if(!t)throw n;t(n)})}function zt(){}const qt=bt("C",void 0,void 0);function bt(n,t,e){return{kind:n,value:t,error:e}}let it=null;class xt extends tt{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Ct(t)&&t.add(this)):this.destination=ae}static create(t,e,r){return new St(t,e,r)}next(t){this.isStopped?Tt(function ee(n){return bt("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Tt(function te(n){return bt("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Tt(qt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ie=Function.prototype.bind;function Pt(n,t){return ie.call(n,t)}class se{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(r){dt(r)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(r){dt(r)}else dt(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){dt(e)}}}class St extends xt{constructor(t,e,r){let i;if(super(),S(t)||!t)i={next:null!=t?t:void 0,error:null!=e?e:void 0,complete:null!=r?r:void 0};else{let s;this&&rt.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=()=>this.unsubscribe(),i={next:t.next&&Pt(t.next,s),error:t.error&&Pt(t.error,s),complete:t.complete&&Pt(t.complete,s)}):i=t}this.destination=new se(i)}}function dt(n){rt.useDeprecatedSynchronousErrorHandling?function re(n){rt.useDeprecatedSynchronousErrorHandling&&it&&(it.errorThrown=!0,it.error=n)}(n):jt(n)}function Tt(n,t){const{onStoppedNotification:e}=rt;e&&ht.setTimeout(()=>e(n,t))}const ae={closed:!0,next:zt,error:function oe(n){throw n},complete:zt},Mt="function"==typeof Symbol&&Symbol.observable||"@@observable";function le(n){return n}let $=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const r=new n;return r.source=this,r.operator=e,r}subscribe(e,r,i){const s=function ue(n){return n&&n instanceof xt||function ce(n){return n&&S(n.next)&&S(n.error)&&S(n.complete)}(n)&&Ct(n)}(e)?e:new St(e,r,i);return function ne(n){if(rt.useDeprecatedSynchronousErrorHandling){const t=!it;if(t&&(it={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:r}=it;if(it=null,e)throw r}}else n()}(()=>{const{operator:o,source:c}=this;s.add(o?o.call(s,c):c?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return new(r=Rt(r))((i,s)=>{const o=new St({next:c=>{try{e(c)}catch(d){s(d),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(e){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(e)}[Mt](){return this}pipe(...e){return function _t(n){return 0===n.length?le:1===n.length?n[0]:function(e){return n.reduce((r,i)=>i(r),e)}}(e)(this)}toPromise(e){return new(e=Rt(e))((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return n.create=t=>new n(t),n})();function Rt(n){var t;return null!==(t=null!=n?n:rt.Promise)&&void 0!==t?t:Promise}function Bt(n){return S(n[Mt])}function Ft(n){return Symbol.asyncIterator&&S(null==n?void 0:n[Symbol.asyncIterator])}function Ut(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const kt=function fe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ht(n){return S(null==n?void 0:n[kt])}function Xt(n){return V(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:r,done:i}=yield _(e.read());if(i)return yield _(void 0);yield yield _(r)}}finally{e.releaseLock()}})}function Wt(n){return S(null==n?void 0:n.getReader)}function ot(n){if(n instanceof $)return n;if(null!=n){if(Bt(n))return function he(n){return new $(t=>{const e=n[Mt]();if(S(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(R(n))return function de(n){return new $(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(W(n))return function ge(n){return new $(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,jt)})}(n);if(Ft(n))return Vt(n);if(Ht(n))return function ye(n){return new $(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(Wt(n))return function pe(n){return Vt(Xt(n))}(n)}throw Ut(n)}function Vt(n){return new $(t=>{(function me(n,t){var e,r,i,s;return function y(n,t,e,r){return new(e||(e=Promise))(function(s,o){function c(x){try{h(r.next(x))}catch(D){o(D)}}function d(x){try{h(r.throw(x))}catch(D){o(D)}}function h(x){x.done?s(x.value):function i(s){return s instanceof e?s:new e(function(o){o(s)})}(x.value).then(c,d)}h((r=r.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=nt(n);!(r=yield e.next()).done;)if(t.next(r.value),t.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=e.return)&&(yield s.call(e))}finally{if(i)throw i.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function lt(n){return t=>{if(function ve(n){return S(null==n?void 0:n.lift)}(t))return t.lift(function(e){try{return n(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function gt(n,t,e,r,i){return new we(n,t,e,r,i)}class we extends xt{constructor(t,e,r,i,s,o){super(t),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=e?function(c){try{e(c)}catch(d){t.error(d)}}:super._next,this._error=i?function(c){try{i(c)}catch(d){t.error(d)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(c){t.error(c)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function yt(n,t){return lt((e,r)=>{let i=0;e.subscribe(gt(r,s=>{r.next(n.call(t,s,i++))}))})}function et(n,t,e,r=0,i=!1){const s=t.schedule(function(){e(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function Yt(n,t,e=1/0){return S(t)?Yt((r,i)=>yt((s,o)=>t(r,s,i,o))(ot(n(r,i))),e):("number"==typeof t&&(e=t),lt((r,i)=>function be(n,t,e,r,i,s,o,c){const d=[];let h=0,x=0,D=!1;const T=()=>{D&&!d.length&&!h&&t.complete()},G=J=>h<r?Q(J):d.push(J),Q=J=>{s&&t.next(J),h++;let at=!1;ot(e(J,x++)).subscribe(gt(t,N=>{null==i||i(N),s?G(N):t.next(N)},()=>{at=!0},void 0,()=>{if(at)try{for(h--;d.length&&h<r;){const N=d.shift();o?et(t,o,()=>Q(N)):Q(N)}T()}catch(N){t.error(N)}}))};return n.subscribe(gt(t,G,()=>{D=!0,T()})),()=>{null==c||c()}}(r,i,n,e)))}const{isArray:xe}=Array;const Te=["addListener","removeListener"],Me=["addEventListener","removeEventListener"],Ee=["on","off"];function Et(n,t,e,r){if(S(e)&&(r=e,e=void 0),r)return Et(n,t,e).pipe(function Se(n){return yt(t=>function Pe(n,t){return xe(t)?n(...t):n(t)}(n,t))}(r));const[i,s]=function Ie(n){return S(n.addEventListener)&&S(n.removeEventListener)}(n)?Me.map(o=>c=>n[o](t,c,e)):function Ae(n){return S(n.addListener)&&S(n.removeListener)}(n)?Te.map(Nt(n,t)):function Oe(n){return S(n.on)&&S(n.off)}(n)?Ee.map(Nt(n,t)):[];if(!i&&R(n))return Yt(o=>Et(o,t,e))(ot(n));if(!i)throw new TypeError("Invalid event target");return new $(o=>{const c=(...d)=>o.next(1<d.length?d:d[0]);return i(c),()=>s(c)})}function Nt(n,t){return e=>r=>n[e](t,r)}function Jt(n,t=0){return lt((e,r)=>{e.subscribe(gt(r,i=>et(r,n,()=>r.next(i),t),()=>et(r,n,()=>r.complete(),t),i=>et(r,n,()=>r.error(i),t)))})}function Kt(n,t=0){return lt((e,r)=>{r.add(n.schedule(()=>e.subscribe(r),t))})}function $t(n,t){if(!n)throw new Error("Iterable cannot be null");return new $(e=>{et(e,t,()=>{const r=n[Symbol.asyncIterator]();et(e,t,()=>{r.next().then(i=>{i.done?e.complete():e.next(i.value)})},0,!0)})})}function Ue(...n){return function Fe(n,t){return t?function Be(n,t){if(null!=n){if(Bt(n))return function Ge(n,t){return ot(n).pipe(Kt(t),Jt(t))}(n,t);if(R(n))return function ze(n,t){return new $(e=>{let r=0;return t.schedule(function(){r===n.length?e.complete():(e.next(n[r++]),e.closed||this.schedule())})})}(n,t);if(W(n))return function je(n,t){return ot(n).pipe(Kt(t),Jt(t))}(n,t);if(Ft(n))return $t(n,t);if(Ht(n))return function _e(n,t){return new $(e=>{let r;return et(e,t,()=>{r=n[kt](),et(e,t,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){return void e.error(o)}s?e.complete():e.next(i)},0,!0)}),()=>S(null==r?void 0:r.return)&&r.return()})}(n,t);if(Wt(n))return function Re(n,t){return $t(Xt(n),t)}(n,t)}throw Ut(n)}(n,t):ot(n)}(n,function Ce(n){return function De(n){return n&&S(n.schedule)}(function At(n){return n[n.length-1]}(n))?n.pop():void 0}(n))}var ke=m(340);class P{static colorMatch(t,e,r=0){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])+Math.abs(t[2]-e[2])<=r}static pointEquals(t,e){return t[0]==e[0]&&t[1]==e[1]}static lineEqualsStrict(t,e){return this.pointEquals([t[0][0],t[0][1]],[e[0][0],e[0][1]])&&this.pointEquals([t[1][0],t[1][1]],[e[1][0],e[1][1]])}static lineCenterPos(t){return[t[0][0]+.5*(t[1][0]-t[0][0]),t[0][1]+.5*(t[1][1]-t[0][1])]}static degreesToRadians(t){return t*(Math.PI/180)}static normalizeAngle(t){return t-this.TWO_PI*Math.floor((t+Math.PI)/this.TWO_PI)}static normalizeAngle10(t){return(t+Math.PI)/this.TWO_PI}static vectorAngle(t){return Math.atan2(t[1],t[0])}static angleToVector(t){return[Math.cos(t),Math.sin(t)]}static angleToVectorMultiplied(t,e){return[Math.cos(t)*e,Math.sin(t)*e]}static lineAngle(t){return this.vectorAngle([t[1][0]-t[0][0],t[1][1]-t[0][1]])}static gateAngle(t){return this.normalizeAngle(this.lineAngle(t)-.5*Math.PI)}static rotatePoint(t,e){const r=Math.cos(e),i=Math.sin(e);return[r*t[0]-i*t[1],i*t[0]+r*t[1]]}static addPoints(t,e){return[t[0]+e[0],t[1]+e[1]]}static rotatedRect(t,e,r){return[this.addPoints(t,this.rotatePoint(e,r)),this.addPoints(t,this.rotatePoint([e[0],-e[1]],r)),this.addPoints(t,this.rotatePoint([-e[0],-e[1]],r)),this.addPoints(t,this.rotatePoint([-e[0],e[1]],r))]}static lineLengthUnnormed(t){const e=t[0][0]-t[1][0],r=t[0][1]-t[1][1];return e*e+r*r}static lineLength(t){return Math.sqrt(this.lineLengthUnnormed(t))}static pointToGate(t,e,r,i=!1){return[this.pointTravel(t,e-.5*Math.PI,r,i),this.pointTravel(t,e+.5*Math.PI,r,i)]}static pointTravel(t,e,r,i=!1){const s=[t[0]+Math.cos(e)*r,t[1]+Math.sin(e)*r];return i&&(s[0]=Math.round(s[0]),s[1]=Math.round(s[1])),s}static centerOfLine(t){return[.5*(t[0][0]+t[1][0]),.5*(t[0][1]+t[1][1])]}static lineIntersectionPoint(t,e){let D,T,G,r=t[0][0],i=t[0][1],s=t[1][0],o=t[1][1],c=e[0][0],d=e[0][1],h=e[1][0],x=e[1][1];return D=(s-r)*(x-d)-(h-c)*(o-i),0!==D&&(G=((x-d)*(h-r)+(c-h)*(x-i))/D,T=((i-o)*(h-r)+(s-r)*(x-i))/D,0<G&&G<1&&0<T&&T<1)?[r+G*(s-r),i+G*(o-i)]:null}static getLineBounds(t){return[Math.min(t[0][1],t[1][1]),Math.min(t[0][0],t[1][0]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]}static getLinesBounds(t){let e=1/0,r=1/0,i=-1/0,s=-1/0;for(const o of t)e=Math.min(e,o[0][1],o[1][1]),r=Math.min(r,o[0][0],o[1][0]),i=Math.max(i,o[0][0],o[1][0]),s=Math.max(s,o[0][1],o[1][1]);return[e,r,i,s]}static hasRectangleCollision(t,e){return t[1]<e[2]&&t[2]>e[1]&&t[0]<e[3]&&t[3]>e[0]}static lineIsValidY(t,e){return t>=e[0][1]&&t<e[1][1]||t>=e[1][1]&&t<e[0][1]}static lineGetM(t){return(t[1][1]-t[0][1])/(t[1][0]-t[0][0])}static lineGetX(t,e){return 1/this.lineGetM(e)*(t-e[0][1])+e[0][0]}static getLinesMeetY(t,e){let r=[];for(let i=0;i<e.length;i++){const s=e[i];this.lineIsValidY(t,s)&&r.push(this.lineGetX(t,s))}for(let i=0;i<r.length;i++)for(let s=i;s<r.length;s++)if(r[i]>r[s]){let o=r[i];r[i]=r[s],r[s]=o}return r}static findDuplicates(t,e){const r=[...t].sort((o,c)=>e(o,c)?0:1),i=[];let s=[];for(let o=0;o<r.length-1;o++)s.push(o),e(r[o+1],r[o])||(i.push(s),s=[]);return i.push(s),i}static findDuplicatesByIndex(t,e){for(let r of e)if(r.includes(t))return r;return[t]}static medianOfPoints(t,e){let r=0,i=0;for(let o of e)r+=t[o][0],i+=t[o][1];const s=e.length;return[r/s,i/s]}static bestMBThroughPoints(t,e){let r=0,i=0,s=0,o=0,c=0,d=0,h=0;if(0===e.length)return console.log("heyo"),[0,0];for(let G of e)d=t[G][0],h=t[G][1],r+=d,i+=h,o+=d*d,s+=d*h,c++;const D=(c*s-r*i)/(c*o-r*r);return[D,i/c-D*r/c]}static bestLineThroughPoints(t,e){let c,d,r=1/0,i=0,s=1/0,o=0;for(let x of e)c=t[x][0],d=t[x][1],r=Math.min(r,c),i=Math.max(i,c),s=Math.min(s,d),o=Math.max(o,d);if(this.bestMBThroughPoints(t,e)[0]<0){let x=r;r=i,i=x}return[[r,s],[i,o]]}static splitLines(t){const e=[];for(let r of t){const i=P.centerOfLine(r);e.push([r[0],i]),e.push([i,r[1]])}return e}}P.TWO_PI=2*Math.PI;class ct{constructor(t={}){this.minSegments=5,this.maxSegments=1e5,this.xComputeFactor=.5,this.yComputeFactor=.5,this.angleComputeFactor=9,this.maxTrys=20,this.maxCurve=45,this.gateDistance=10,this.curveComputeCount=4,this.maxIterations=1e6,this.minGateHalfSize=5,this.maxGateHalfSize=15,this.maxGateHalfSizeChange=1,this.maxCollisions=0,this.distanceMatch=19,this.angleMatch=.3;for(const e of this.getPropertyNames()){let r=t[e];"undefined"!==this.getType(r)&&"number"===this.getType(this.getProperty(e))&&(r=+r),this.setProperty(e,r)}}getType(t){return typeof t}setProperty(t,e){this.getType(this.getProperty(t))===this.getType(e)&&(this[t]=e)}getProperty(t){return this[t]}getPropertyNames(){return Object.getOwnPropertyNames(this)}validate(){this.minSegments=Math.min(this.minSegments,this.maxSegments)}copy(){return ct.unserialize(this.serialize())}serialize(){return JSON.stringify(Object.assign({},this))}static unserialize(t){return new ct(JSON.parse(t))}}class ut{static drawPoint(t,e,r="#fff"){null!==t&&(t.fillStyle=r,t.fillRect(e[0]-1,e[1]-1,2,2))}static drawGate(t,e,r="#f00",i="#0f0"){null!==t&&(this.drawPoint(t,e[0],r),this.drawPoint(t,e[1],i))}static drawLine(t,e,r="#f00",i=1){null!==t&&(t.strokeStyle=r,t.lineWidth=i,t.beginPath(),t.moveTo(e[0][0],e[0][1]),t.lineTo(e[1][0],e[1][1]),t.closePath(),t.stroke())}static drawPolygon(t,e,r="#fff",i=null){if(null!==t&&0!=e.length){null!==r&&(t.fillStyle=r),null!==i&&(t.strokeStyle=i,t.lineWidth=1),t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(let s=1;s<e.length;s++)t.lineTo(e[s][0],e[s][1]);t.lineTo(e[0][0],e[0][1]),t.closePath(),null!==r&&t.fill(),null!==i&&t.stroke()}}static drawGateArrow(t,e,r,i="#fff"){if(null===t)return;t.strokeStyle=i,t.lineWidth=1;let s=-P.gateAngle(e),o=P.centerOfLine(e),c=P.angleToVectorMultiplied(s,r),d=[o[0]+c[0],o[1]+c[1]];if(r<0){let h=o;o=d,d=h,s+=Math.PI}t.beginPath(),t.moveTo(o[0],o[1]),t.lineTo(d[0],d[1]),c=P.angleToVectorMultiplied(s+.3,.8*r),t.lineTo(o[0]+c[0],o[1]+c[1]),t.moveTo(d[0],d[1]),c=P.angleToVectorMultiplied(s-.3,.8*r),t.lineTo(o[0]+c[0],o[1]+c[1]),t.closePath(),t.stroke()}}class pt{constructor(t,e,r,i,s=[]){this.drivePath=void 0,this.barrierLines=void 0,this.width=t,this.height=e,this.collisions=r,this.gates=i,this.deletedBarriers=s}clone(){return new pt(this.width,this.height,this.collisions,this.gates,this.deletedBarriers)}serialize(){return JSON.stringify({width:this.width,height:this.height,collisions:this.collisions,gates:this.gates,deletedBarriers:this.deletedBarriers})}static unserialize(t){const e=JSON.parse(t);return new pt(e.width,e.height,e.collisions,e.gates,e.deletedBarriers)}calculateBarrierLines(){this.barrierLines={left:[],right:[]};for(let t=this.gates.length-1;t>1;t--)for(let e of[0,1]){let r=this.barrierLines.left;1==e&&(r=this.barrierLines.right),r.push([this.gates[t][e],this.gates[t-1][e]])}}getBarrierLines(){return void 0===this.barrierLines&&this.calculateBarrierLines(),this.barrierLines}calculateDrivePath(){this.drivePath=[];for(let t=0;t<this.gates.length;t++){const e=P.centerOfLine(this.gates[t]);this.drivePath.push([e[0],e[1],P.lineLength(this.gates[t])/2])}}getDrivePath(){return void 0===this.drivePath&&this.calculateDrivePath(),this.drivePath}firstGate(){return this.gates[0]}lastGate(){return this.gates[this.gates.length-1]}deleteLastGates(t){this.gates.splice(this.gates.length-t,t)}drawBarrierLines(t,e="#fff",r=null,i=1,s=null){null===r&&(r=e),null===s&&(s=i);const o=this.getBarrierLines();for(let c=0;c<o.left.length;c++)this.deletedBarriers.includes(2*c)||ut.drawLine(t,o.left[c],e,i);for(let c=0;c<o.right.length;c++)this.deletedBarriers.includes(2*c+1)||ut.drawLine(t,o.right[c],r,s)}drawDrivePath(t,e="#fff",r=1){const i=this.getDrivePath();for(let s=0;s<i.length-1;s++)ut.drawLine(t,[i[s],i[s+1]],e,r)}clearContext(t){null!==t&&t.clearRect(0,0,this.width,this.height)}drawTrack(t,e=0,r=-1){null!==t&&(this.clearContext(t),this.drawBarrierLines(t,"#ff0","#ff0",1,1),this.drawDrivePath(t,"#00f",1),r<0&&(r=this.gates.length),0!=r&&(ut.drawGateArrow(t,this.firstGate(),10,"#0f0"),ut.drawGateArrow(t,this.lastGate(),-10,"#f00")))}}class Ot{constructor(t,e,r,i="random",s="",o=new ct){this.track=t,this.startGate=e,this.endGate=r,this.mode=i,this.settings=o,this.seed=s,this.random=ke(s)}boundsLines(){return[[[0,0],[this.track.width,0]],[[0,0],[0,this.track.height]],[[this.track.width,this.track.height],[this.track.width,0]],[[this.track.width,this.track.height],[0,this.track.height]]]}pointOutBounds(t){return t[0]<0||t[1]<0||t[0]>this.track.width||t[1]>this.track.height}lineOutBounds(t){return this.pointOutBounds(t[0])||this.pointOutBounds(t[1])}gateHasCollision(t,e,r){const i=[[t[0],e[0]],[e[0],e[1]],[e[1],t[1]]];if(this.hasPolyPixelCollision([t[0],e[0],e[1],t[1]]))return!0;for(let s of i){const o=this.track.gates.concat(r);for(let c=o.length-1;c>1;c--)for(let d of[0,1])if(null!==P.lineIntersectionPoint([s[0],s[1]],[o[c][d],o[c-1][d]]))return!0}return!1}hasPolyPixelCollision(t){const e=[];for(let o=1;o<t.length;o++)e.push([t[o-1],t[o]]);e.push([t[t.length-1],t[0]]);const r=P.getLinesBounds(e),i=Math.floor(r[0]),s=Math.ceil(r[3]);for(let o=i;o<s;o++){const c=P.getLinesMeetY(o,e);for(let d=1;d<c.length;d+=2){const h=Math.ceil(c[d]);for(let x=Math.floor(c[d-1]);x<h;x++)if(this.pointOutBounds([x,o])||this.track.collisions[o][x])return!0}}return!1}getLinePixelCollisions(t){const e=P.lineCenterPos(t),r=P.angleToVectorMultiplied(P.lineAngle(t),1);let i=e;const s=[];for(let o of[-1,1])for(;;){const c=[Math.floor(i[0]),Math.floor(i[1])];if(this.pointOutBounds(c))break;try{if(this.track.collisions[c[1]][c[0]]){s.push(i);break}}catch(d){s.push(i);break}i=[i[0]+r[0]*o,i[1]+r[1]*o]}return s}serialize(){return JSON.stringify({track:this.track.serialize(),start:this.startGate,end:this.endGate,mode:this.mode,seed:this.seed,settings:this.settings.serialize()})}static unserialize(t){const e=JSON.parse(t);return new Ot(pt.unserialize(e.track),e.start,e.end,e.mode,e.seed,ct.unserialize(e.settings))}calcMaxGateHalfSize(t,e){let s,r=P.pointToGate(t,e,this.track.width*this.track.height),i=+this.settings.maxGateHalfSize;const o=this.track.gates.concat(this.boundsLines()),c=[];for(let d=o.length-1;d>1;d--)for(let h of[0,1])c.push([o[d][h],o[d-1][h]]);for(let d of c)if(s=P.lineIntersectionPoint(r,d),null!==s){const h=P.lineLength([s,t]);if(h<0)return 0;h<i&&(i=h)}for(let d of this.getLinePixelCollisions(r)){const h=P.lineLength([d,t]);if(h<0)return 0;h<i&&(i=h)}return i}predictDirections(t,e,r,i){const s=P.lineAngle([t,e]),o=[P.normalizeAngle(r)];for(let d=+this.settings.curveComputeCount-1;d>0;d--){const h=d*P.degreesToRadians(+this.settings.maxCurve)/+this.settings.curveComputeCount;o.push(P.normalizeAngle(r+h)),o.push(P.normalizeAngle(r-h))}o.sort((d,h)=>Math.abs(P.normalizeAngle(s-h))-Math.abs(P.normalizeAngle(s-d)));const c=[];for(const d of o){const h=P.angleToVectorMultiplied(d,+this.settings.gateDistance),x=[Math.floor(t[0]+h[0]),Math.floor(t[1]+h[1])],D=Math.min(+this.settings.maxGateHalfSize,this.calcMaxGateHalfSize(x,d));if(D<+this.settings.minGateHalfSize)continue;let T=i+2*(this.random()-.5)*+this.settings.maxGateHalfSizeChange;T=Math.min(D,T),T=Math.max(+this.settings.minGateHalfSize,T),c.push([x,d,T])}return c}pointAngleMatches(t,e,r,i){return!(P.lineLengthUnnormed([t,r])>+this.settings.distanceMatch||Math.abs(P.normalizeAngle(e-i))>+this.settings.angleMatch)}posAngleToGrid(t,e){return[Math.floor(t[1]*+this.settings.yComputeFactor),Math.floor(t[0]*+this.settings.xComputeFactor),Math.floor(P.normalizeAngle10(e)*+this.settings.angleComputeFactor)]}isValidGridPos(t,e){return t[0]>=0&&t[0]<e[0]&&t[1]>=0&&t[1]<e[1]&&t[2]>=0&&t[2]<e[2]}findTrackDFS(t=0,e=0){this.settings.validate();const r=[],i=P.lineCenterPos(this.endGate),s=P.gateAngle(this.endGate),o=this.posAngleToGrid([this.track.width,this.track.height],Math.PI);console.log("grid size",o);const c=new Array(o[0]);for(let d=0;d<o[0];d++){c[d]=new Array(o[1]);for(let h=0;h<o[1];h++){c[d][h]=new Array(o[2]);for(let x=0;x<o[2];x++)c[d][h][x]=!1}}for(r.push([this.startGate,[],0]);;){let d=r.pop();if(void 0===d)return e>=+this.settings.maxTrys-1?[[],!1,t]:(this.settings.angleComputeFactor+=1,this.findTrackDFS(t,e+1));const h=d[0],x=d[1];let D=d[2];const T=P.lineCenterPos(h),G=P.gateAngle(h),Q=P.lineLength(h)/2,J=this.posAngleToGrid(T,G);c[J[0]][J[1]][J[2]]=!0;const at=this.pointAngleMatches(T,G,i,s),N=x.length,Qt=at&&N>=+this.settings.minSegments;if(Qt||N>=+this.settings.maxSegments)return Qt&&x.push(this.endGate),console.log(N+" segments"),console.log(D+" collisions"),[x,at,t];this.progressEmitter&&this.progressEmitter([x,at,t]);let mt=this.predictDirections(T,i,G,Q);switch(this.mode){case"longest":mt.reverse();break;case"random":mt.sort(()=>.5-this.random());break;case"maxwidth":mt.sort((ft,vt)=>ft[2]-vt[2])}for(let ft of mt){const vt=ft[0],Zt=ft[1],It=P.pointToGate(vt,Zt,ft[2]),wt=this.posAngleToGrid(vt,Zt);this.isValidGridPos(wt,o)&&!c[wt[0]][wt[1]][wt[2]]&&!this.lineOutBounds(It)&&(this.gateHasCollision(h,It,x)&&(D+=1),D<=+this.settings.maxCollisions&&r.push([It,x.concat([h]),D]))}if(++t>+this.settings.maxIterations)return[[],!1,t]}}findTrackDFSWorker(t=!0){if(t&&"undefined"!=typeof Worker){const e=new Worker(m.tu(new URL(m.p+m.u(622),m.b))),r=Et(e,"message").pipe(yt(i=>i.data),function Le(n){return lt((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}(()=>e.postMessage({type:"stop"})));return e.postMessage({type:"start",trackGenerator:this.serialize()}),r}return Ue(this.findTrackDFS())}generate(t=!0){const e=(new Date).getTime(),r=[...this.track.gates];return this.findTrackDFSWorker(t).pipe(yt(i=>{const s=(new Date).getTime()-e;if(0==i[0].length)return console.log("path was not found!"),[s,i[2]];const o=i[0];return i[1]&&console.log("path is finished"),this.track.gates=[...r,...o],[s,i[2]]}))}}addEventListener("message",({data:n})=>{if("start"===n.type){const t=Ot.unserialize(n.trackGenerator);t.progressEmitter=e=>postMessage(e,[]),postMessage(t.findTrackDFS())}else console.log("stop")})},340:(w,O,m)=>{var E=m(471),F=m(992),b=m(657),U=m(583),L=m(929),C=m(83),M=m(818);M.alea=E,M.xor128=F,M.xorwow=b,M.xorshift7=U,M.xor4096=L,M.tychei=C,w.exports=M},471:function(w,O,m){var E;!function(F,b,U){function L(a){var f=this,g=function y(){var a=4022871197;return function(g){g=String(g);for(var l=0;l<g.length;l++){var u=.02519603282416938*(a+=g.charCodeAt(l));u-=a=u>>>0,a=(u*=a)>>>0,a+=4294967296*(u-=a)}return 2.3283064365386963e-10*(a>>>0)}}();f.next=function(){var l=2091639*f.s0+2.3283064365386963e-10*f.c;return f.s0=f.s1,f.s1=f.s2,f.s2=l-(f.c=0|l)},f.c=1,f.s0=g(" "),f.s1=g(" "),f.s2=g(" "),f.s0-=g(a),f.s0<0&&(f.s0+=1),f.s1-=g(a),f.s1<0&&(f.s1+=1),f.s2-=g(a),f.s2<0&&(f.s2+=1),g=null}function C(a,f){return f.c=a.c,f.s0=a.s0,f.s1=a.s1,f.s2=a.s2,f}function M(a,f){var g=new L(a),l=f&&f.state,u=g.next;return u.int32=function(){return 4294967296*g.next()|0},u.double=function(){return u()+11102230246251565e-32*(2097152*u()|0)},u.quick=u,l&&("object"==typeof l&&C(l,g),u.state=function(){return C(g,{})}),u}b&&b.exports?b.exports=M:m.amdD&&m.amdO?void 0!==(E=function(){return M}.call(O,m,O,b))&&(b.exports=E):this.alea=M}(0,w=m.nmd(w))},83:function(w,O,m){var E;!function(F,b,U){function L(y){var a=this,f="";a.next=function(){var l=a.b,u=a.c,p=a.d,v=a.a;return l=l<<25^l>>>7^u,u=u-p|0,p=p<<24^p>>>8^v,v=v-l|0,a.b=l=l<<20^l>>>12^u,a.c=u=u-p|0,a.d=p<<16^u>>>16^v,a.a=v-l|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,y===Math.floor(y)?(a.a=y/4294967296|0,a.b=0|y):f+=y;for(var g=0;g<f.length+20;g++)a.b^=0|f.charCodeAt(g),a.next()}function C(y,a){return a.a=y.a,a.b=y.b,a.c=y.c,a.d=y.d,a}function M(y,a){var f=new L(y),g=a&&a.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,g&&("object"==typeof g&&C(g,f),l.state=function(){return C(f,{})}),l}b&&b.exports?b.exports=M:m.amdD&&m.amdO?void 0!==(E=function(){return M}.call(O,m,O,b))&&(b.exports=E):this.tychei=M}(0,w=m.nmd(w))},992:function(w,O,m){var E;!function(F,b,U){function L(y){var a=this,f="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var l=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^l^l>>>8},y===(0|y)?a.x=y:f+=y;for(var g=0;g<f.length+64;g++)a.x^=0|f.charCodeAt(g),a.next()}function C(y,a){return a.x=y.x,a.y=y.y,a.z=y.z,a.w=y.w,a}function M(y,a){var f=new L(y),g=a&&a.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,g&&("object"==typeof g&&C(g,f),l.state=function(){return C(f,{})}),l}b&&b.exports?b.exports=M:m.amdD&&m.amdO?void 0!==(E=function(){return M}.call(O,m,O,b))&&(b.exports=E):this.xor128=M}(0,w=m.nmd(w))},929:function(w,O,m){var E;!function(F,b,U){function L(y){var a=this;a.next=function(){var p,v,g=a.w,l=a.X,u=a.i;return a.w=g=g+1640531527|0,v=l[u+34&127],p=l[u=u+1&127],v^=v<<13,p^=p<<17,v=l[u]=(v^=v>>>15)^(p^=p>>>12),a.i=u,v+(g^g>>>16)|0},function f(g,l){var u,p,v,k,_,V=[],st=128;for(l===(0|l)?(p=l,l=null):(l+="\0",p=0,st=Math.max(st,l.length)),v=0,k=-32;k<st;++k)l&&(p^=l.charCodeAt((k+32)%l.length)),0===k&&(_=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,k>=0&&(v=0==(u=V[127&k]^=p+(_=_+1640531527|0))?v+1:0);for(v>=128&&(V[127&(l&&l.length||0)]=-1),v=127,k=512;k>0;--k)p=V[v+34&127],u=V[v=v+1&127],p^=p<<13,u^=u<<17,V[v]=(p^=p>>>15)^(u^=u>>>12);g.w=_,g.X=V,g.i=v}(a,y)}function C(y,a){return a.i=y.i,a.w=y.w,a.X=y.X.slice(),a}function M(y,a){null==y&&(y=+new Date);var f=new L(y),g=a&&a.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,g&&(g.X&&C(g,f),l.state=function(){return C(f,{})}),l}b&&b.exports?b.exports=M:m.amdD&&m.amdO?void 0!==(E=function(){return M}.call(O,m,O,b))&&(b.exports=E):this.xor4096=M}(0,w=m.nmd(w))},583:function(w,O,m){var E;!function(F,b,U){function L(y){var a=this;a.next=function(){var u,p,g=a.x,l=a.i;return u=g[l],p=(u^=u>>>7)^u<<24,p^=(u=g[l+1&7])^u>>>10,p^=(u=g[l+3&7])^u>>>3,p^=(u=g[l+4&7])^u<<7,u=g[l+7&7],g[l]=p^=(u^=u<<13)^u<<9,a.i=l+1&7,p},function f(g,l){var u,v=[];if(l===(0|l))v[0]=l;else for(l=""+l,u=0;u<l.length;++u)v[7&u]=v[7&u]<<15^l.charCodeAt(u)+v[u+1&7]<<13;for(;v.length<8;)v.push(0);for(u=0;u<8&&0===v[u];++u);for(8==u&&(v[7]=-1),g.x=v,g.i=0,u=256;u>0;--u)g.next()}(a,y)}function C(y,a){return a.x=y.x.slice(),a.i=y.i,a}function M(y,a){null==y&&(y=+new Date);var f=new L(y),g=a&&a.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,g&&(g.x&&C(g,f),l.state=function(){return C(f,{})}),l}b&&b.exports?b.exports=M:m.amdD&&m.amdO?void 0!==(E=function(){return M}.call(O,m,O,b))&&(b.exports=E):this.xorshift7=M}(0,w=m.nmd(w))},657:function(w,O,m){var E;!function(F,b,U){function L(y){var a=this,f="";a.next=function(){var l=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^l^l<<1)|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,y===(0|y)?a.x=y:f+=y;for(var g=0;g<f.length+64;g++)a.x^=0|f.charCodeAt(g),g==f.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function C(y,a){return a.x=y.x,a.y=y.y,a.z=y.z,a.w=y.w,a.v=y.v,a.d=y.d,a}function M(y,a){var f=new L(y),g=a&&a.state,l=function(){return(f.next()>>>0)/4294967296};return l.double=function(){do{var v=((f.next()>>>11)+(f.next()>>>0)/4294967296)/(1<<21)}while(0===v);return v},l.int32=f.next,l.quick=l,g&&("object"==typeof g&&C(g,f),l.state=function(){return C(f,{})}),l}b&&b.exports?b.exports=M:m.amdD&&m.amdO?void 0!==(E=function(){return M}.call(O,m,O,b))&&(b.exports=E):this.xorwow=M}(0,w=m.nmd(w))},818:function(w,O,m){var E;!function(F,b,U){var u,L=256,a=U.pow(L,6),f=U.pow(2,52),g=2*f,l=255;function p(A,I,B){var z=[],j=V(_((I=1==I?{entropy:!0}:I||{}).entropy?[A,nt(b)]:null==A?function st(){try{var A;return u&&(A=u.randomBytes)?A=A(L):(A=new Uint8Array(L),(F.crypto||F.msCrypto).getRandomValues(A)),nt(A)}catch(z){var I=F.navigator,B=I&&I.plugins;return[+new Date,F,B,F.screen,nt(b)]}}():A,3),z),X=new v(z),Y=function(){for(var R=X.g(6),S=a,W=0;R<f;)R=(R+W)*L,S*=L,W=X.g(1);for(;R>=g;)R/=2,S/=2,W>>>=1;return(R+W)/S};return Y.int32=function(){return 0|X.g(4)},Y.quick=function(){return X.g(4)/4294967296},Y.double=Y,V(nt(X.S),b),(I.pass||B||function(R,S,W,K){return K&&(K.S&&k(K,X),R.state=function(){return k(X,{})}),W?(U.random=R,S):R})(Y,j,"global"in I?I.global:this==U,I.state)}function v(A){var I,B=A.length,z=this,j=0,X=z.i=z.j=0,Y=z.S=[];for(B||(A=[B++]);j<L;)Y[j]=j++;for(j=0;j<L;j++)Y[j]=Y[X=l&X+A[j%B]+(I=Y[j])],Y[X]=I;(z.g=function(R){for(var S,W=0,K=z.i,Z=z.j,q=z.S;R--;)S=q[K=l&K+1],W=W*L+q[l&(q[K]=q[Z=l&Z+S])+(q[Z]=S)];return z.i=K,z.j=Z,W})(L)}function k(A,I){return I.i=A.i,I.j=A.j,I.S=A.S.slice(),I}function _(A,I){var j,B=[],z=typeof A;if(I&&"object"==z)for(j in A)try{B.push(_(A[j],I-1))}catch(X){}return B.length?B:"string"==z?A:A+"\0"}function V(A,I){for(var z,B=A+"",j=0;j<B.length;)I[l&j]=l&(z^=19*I[l&j])+B.charCodeAt(j++);return nt(I)}function nt(A){return String.fromCharCode.apply(0,A)}if(V(U.random(),b),w.exports){w.exports=p;try{u=m(42)}catch(A){}}else void 0!==(E=function(){return p}.call(O,m,O,w))&&(w.exports=E)}("undefined"!=typeof self?self:this,[],Math)},42:()=>{}},Dt={};function H(w){var O=Dt[w];if(void 0!==O)return O.exports;var m=Dt[w]={id:w,loaded:!1,exports:{}};return Lt[w].call(m.exports,m,m.exports,H),m.loaded=!0,m.exports}H.m=Lt,H.amdD=function(){throw new Error("define cannot be used indirect")},H.amdO={},H.u=w=>w+".3134391add565db8.js",H.o=(w,O)=>Object.prototype.hasOwnProperty.call(w,O),H.nmd=w=>(w.paths=[],w.children||(w.children=[]),w),H.tt=()=>(void 0===w&&(w={createScriptURL:O=>O},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(w=trustedTypes.createPolicy("angular#bundler",w))),w),H.tu=w=>H.tt().createScriptURL(w),H.p="",H.b=self.location+"",H(622)})();